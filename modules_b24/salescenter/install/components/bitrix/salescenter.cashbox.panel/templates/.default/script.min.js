(function(){"use strict";BX.namespace("BX.SaleCenterCashbox");BX.SaleCenterCashbox={init:function(e){this.cashboxParams=e.cashboxParams;var t=new BX.TileGrid.Grid(this.cashboxParams);t.draw()}};BX.SaleCenterCashbox.TileGrid=function(e){BX.TileGrid.Item.apply(this,arguments);this.title=e.title;this.image=e.image;this.itemSelected=e.itemSelected;this.itemSelectedColor=e.itemSelectedColor;this.itemSelectedImage=e.itemSelectedImage;this.layout={container:null,image:null,title:null,clipTitle:null,company:null,controls:null,buttonAction:null,price:null};this.data=e.data||{}};BX.SaleCenterCashbox.TileGrid.prototype={__proto__:BX.TileGrid.Item.prototype,constructor:BX.TileGrid.Item,getContent:function(){if(!this.layout.wrapper){this.layout.wrapper=BX.create("div",{props:{className:"salescenter-cashbox-item"},children:[BX.create("div",{props:{className:"salescenter-cashbox-item-content"},children:[this.getImage(),this.getTitle(),this.getStatus()]})],events:{click:function(){this.onClick()}.bind(this)}})}this.itemSelected?this.setSelected():null;return this.layout.wrapper},getImage:function(){if(!this.layout.image){this.layout.image=BX.create("div",{props:{className:"salescenter-cashbox-item-image"},style:{backgroundImage:this.image?"url("+this.image+")":null}})}return this.layout.image},getStatus:function(){if(!this.itemSelected)return;this.layout.itemSelected=BX.create("div",{props:{className:"salescenter-cashbox-item-status-selected"}});return this.layout.itemSelected},setSelected:function(){if(!this.itemSelected)return;BX.addClass(this.layout.wrapper,"salescenter-cashbox-item-selected");if(this.itemSelectedImage){this.layout.image.style.backgroundImage="url("+this.itemSelectedImage+")"}if(this.itemSelectedColor){this.layout.wrapper.style.backgroundColor=this.itemSelectedColor}this.layout.itemSelected=BX.create("div",{props:{className:"salescenter-cashbox-item-status-selected"}});this.layout.wrapper.appendChild(this.layout.itemSelected)},setUnselected:function(){if(this.itemSelected){return}BX.removeClass(this.layout.wrapper,"salescenter-cashbox-item-selected");if(this.image){this.layout.image.style.backgroundImage="url("+this.image+")"}this.layout.wrapper.style.backgroundColor="";var e=this.layout.wrapper.querySelector(".salescenter-cashbox-item-status-selected");if(e){e.parentNode.removeChild(e)}},getTitle:function(){if(!this.layout.title){this.layout.title=BX.create("div",{props:{className:"salescenter-cashbox-item-title"},text:this.title})}return this.layout.title},onClick:function(){this.formData="";var e={allowChangeHistory:false,width:1e3,events:{onLoad:function(e){var t=e.getSlider();this.formData=this.getAllFormData(t)}.bind(this),onClose:function(e){if(this.onCloseSlider(e)){this.reloadCashboxItem(this.data.handler)}}.bind(this)}};if(!this.itemSelected&&!this.data.showMenu){BX.SidePanel.Instance.open(this.data.connectPath,e)}else{this.showItemMenu(this,{sliderOptions:e})}},onCloseSlider:function(e){var t=this.getSliderDocument(e.slider);var i=t.getElementById("salescenter-form-is-saved");if(i&&i.value==="y"){return true}var s=this.getAllFormData(e.slider);if(this.formData===s||this.isClose===true){this.isClose=false;return false}e.action=false;this.popup=new BX.PopupWindow("salescenter_slider_close_confirmation",null,{autoHide:false,draggable:false,closeByEsc:false,offsetLeft:0,offsetTop:0,zIndex:e.slider.zIndex+100,bindOptions:{forceBindPosition:true},titleBar:BX.message("SCP_POPUP_TITLE"),content:BX.message("SCP_POPUP_CONTENT"),buttons:[new BX.PopupWindowButton({text:BX.message("SCP_POPUP_BUTTON_CLOSE"),className:"ui-btn ui-btn-success",events:{click:BX.delegate(this.onCloseConfirmButtonClick.bind(this,"close"))}}),new BX.PopupWindowButtonLink({text:BX.message("SCP_POPUP_BUTTON_CANCEL"),className:"ui-btn ui-btn-link",events:{click:BX.delegate(this.onCloseConfirmButtonClick.bind(this,"cancel"))}})],events:{onPopupClose:function(){this.destroy()}}});this.popup.show();return false},onCloseConfirmButtonClick:function(e){this.popup.close();if(BX.SidePanel.Instance.getTopSlider()){BX.SidePanel.Instance.getTopSlider().focus()}if(e==="close"){this.isClose=true;BX.SidePanel.Instance.getTopSlider().close()}},showItemMenu:function(e,t){var i=[],s,a=e.layout.container,n="salescenter-item-menu-"+BX.util.getRandomString(),o;e.sliderOptions={};if(t.sliderOptions){e.sliderOptions=t.sliderOptions}for(s in e.data.menuItems){if(e.data.menuItems.hasOwnProperty(s)){if(e.data.menuItems[s].DELIMITER){i.push({delimiter:true})}else{i.push({text:e.data.menuItems[s].NAME,link:e.data.menuItems[s].LINK,onclick:function(t,i){e.moreTabsMenu.close();BX.SidePanel.Instance.open(i.options.link,e.sliderOptions)}})}}}e.moreTabsMenu=BX.PopupMenu.create(n,a,i,{autoHide:true,offsetLeft:0,offsetTop:0,closeByEsc:true,events:{onPopupClose:function(){e.moreTabsMenu.popupWindow.destroy();BX.PopupMenu.destroy(n)},onPopupDestroy:function(){e.moreTabsMenu=null}}});e.moreTabsMenu.popupWindow.show()},reloadCashboxItem:function(e){var t=this;BX.ajax.runComponentAction("bitrix:salescenter.cashbox.panel","reloadCashboxItem",{mode:"class",data:{handler:e}}).then(function(e){t.itemSelected=e.data.itemSelected;if(t.itemSelected){t.setSelected()}else{t.setUnselected()}t.data.menuItems=e.data.menuItems;t.data.showMenu=e.data.showMenu})},getAllFormData:function(e){var t=this.getSliderDocument(e);var i=t.getElementsByTagName("form");if(i&&i.length>0){var s=BX.ajax.prepareForm(i[0]),a;for(a in s.data){if(s.data.hasOwnProperty(a)&&a===""){delete s.data[a]}}return!!s&&s.data?JSON.stringify(s.data):""}return""},getSliderDocument:function(e){var t,i;t=e.iframe;i=t.contentDocument||t.contentWindow.document;return i}}})();
//# sourceMappingURL=script.map.js