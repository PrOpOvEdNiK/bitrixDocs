(function(){BX.namespace("BX.Call");if(BX.Call.Util){return}BX.Call.Util={userData:{},usersInProcess:{},updateUserData:function(e){var r=[];var t=this;for(var a=0;a<e.length;a++){if(this.userData.hasOwnProperty(e[a])){continue}r.push(e[a])}var n=new Promise(function(e,a){if(r.length===0){return e()}BX.rest.callMethod("im.user.list.get",{ID:r,AVATAR_HR:"Y"}).then(function(r){var a=r.answer.result;if(BX.type.isPlainObject(a)){for(var n in a){t.userData[n]=a[n];delete t.usersInProcess[n]}}e()}).catch(function(e){a(e.answer)})});for(var a=0;a<r.length;a++){this.usersInProcess[r[a]]=n}return n},getDateForLog:function(){var e=new Date;return e.getFullYear()+"-"+this.lpad(e.getMonth(),2,"0")+"-"+this.lpad(e.getDate(),2,"0")+" "+this.lpad(e.getHours(),2,"0")+":"+this.lpad(e.getMinutes(),2,"0")+":"+this.lpad(e.getSeconds(),2,"0")+"."+e.getMilliseconds()},getTimeForLog:function(){var e=new Date;return this.lpad(e.getHours(),2,"0")+":"+this.lpad(e.getMinutes(),2,"0")+":"+this.lpad(e.getSeconds(),2,"0")+"."+e.getMilliseconds()},lpad:function(e,r,t){e=e.toString();t=t||" ";if(e.length>r){return e}var a="";for(var n=0;n<r-e.length;n++){a+=t}return a+e},getUser:function(e){var r=this;return new Promise(function(t,a){if(r.userData.hasOwnProperty(e)){return t(r.userData[e])}else if(r.usersInProcess.hasOwnProperty(e)){r.usersInProcess[e].then(function(){return t(r.userData[e])})}else{r.updateUserData([e]).then(function(){return t(r.userData[e])})}})},getUserName:function(e){var r=this;return new Promise(function(t,a){if(r.userData.hasOwnProperty(e)){return t(r.userData[e].name?r.userData[e].name:"")}else if(r.usersInProcess.hasOwnProperty(e)){r.usersInProcess[e].then(function(){return t(r.userData[e].name?r.userData[e].name:"")})}else{r.updateUserData([e]).then(function(){return t(r.userData[e].name?r.userData[e].name:"")})}})},getUserAvatar:function(e){var r=this;return new Promise(function(t,a){if(r.userData.hasOwnProperty(e)){return t(r.userData[e].avatar_hr?r.userData[e].avatar_hr:"")}else if(r.usersInProcess.hasOwnProperty(e)){r.usersInProcess[e].then(function(){return t(r.userData[e].avatar_hr?r.userData[e].avatar_hr:"")})}else{r.updateUserData([e]).then(function(){return t(r.userData[e].avatar_hr?r.userData[e].avatar_hr:"")})}})},getCustomMessage:function(e,r){var t;if(!BX.type.isPlainObject(r)){r={}}if(r.gender&&BX.message.hasOwnProperty(e+"_"+r.gender)){t=BX.message(e+"_"+r.gender)}else{t=BX.message(e)}r=this.convertKeysToUpper(r);return t.replace(/#.+?#/gm,function(e){var t=e.substr(1,e.length-2);return r.hasOwnProperty(t)?r[t]:e})},convertKeysToUpper:function(e){var r=BX.util.objectClone(e);for(var t in r){var a=t.toUpperCase();if(a!=t){r[a]=r[t];delete r[t]}}return r},appendChildren:function(e,r){r.forEach(function(r){e.appendChild(r)})},containsVideoTrack:function(e){if(!(e instanceof MediaStream))return false;return e.getVideoTracks().length>0},findRowCount:function(e,r,t){var a=0;var n=0;for(var s=1;s<=t;s++){var u=this.getFilledArea(e,r,t,s);if(u>n){a=s;n=u}}return a},getFilledArea:function(e,r,t,a){var n=Math.ceil(t/a);var s=e/n;var u=r/a;var i=u/s;var o=9/16;var c;var f;if(i<o){c=u;f=s*(i/o)}else{f=s;c=u*(o/i)}var l=f*c*t;return l},alterSDP:function(r,t){if(!t){return}var a=r.split("\n");var n=[];var s=false;for(var u=0;u<a.length;u++){var i=a[u];s=s||(i.match(/m=video/)!==null?u:false);if(!s){continue}var o=/a=rtpmap:(\d+)\s(.+)/.exec(i);if(o){n.push({rtpmap:o[1],codec:o[2]})}}if(!s){return}a[s]=e(a[s],n,t);return a.join("\n")}};function e(e,r,t){debugger;var a=e.split(" ");var n=a.slice(3);var s={};r.forEach(function(e){s[e.rtpmap]=e.codec});n.sort(function(e,r){e=e.trim();r=r.trim();var t=s[e];var a=s[r];if(t.substr(0,4)==="H264"&&a.substr(0,4)!=="H264"){return-1}else if(t.substr(0,4)!=="H264"&&a.substr(0,4)==="H264"){return 1}else{return e-r}});var u=a.slice(0,3).concat(n);return u.join(" ")}})();
//# sourceMappingURL=util.map.js