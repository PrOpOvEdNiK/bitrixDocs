<? $GLOBALS['_653151643_']=Array(base64_decode('cHJlZ19' .'xdW90ZQ=='),base64_decode('Y2hy'),base64_decode('YXJyYXlf' .'bWFw'),base64_decode('Ymlu' .'MmhleA=' .'='),base64_decode('Y' .'XJyYXl' .'fbW' .'V' .'yZ2' .'U='),base64_decode('a' .'XNfZGl' .'y'),base64_decode('bWtkaXI' .'='),base64_decode('ZGF0ZQ' .'=='),base64_decode('dHJpb' .'Q=='),base64_decode('' .'bXRfcm' .'FuZA' .'=='),base64_decode('dm' .'Fy' .'X2' .'R1bXA='),base64_decode('bXRfcmFuZA=='),base64_decode('c3Ryc' .'mV2'),base64_decode('c3R' .'yc' .'G9z'),base64_decode('YmFzZTY' .'0X2RlY' .'29kZQ=='),base64_decode('' .'c3RycG9z'),base64_decode('c29ja' .'2V' .'0X2' .'dldF9zdGF0dXM' .'='),base64_decode('' .'bXRfcmFu' .'ZA=='),base64_decode('Y3Vy' .'bF9tdWx' .'0aV9n' .'Z' .'XRj' .'b250ZW50'),base64_decode('c' .'3' .'R' .'y' .'X3Jlc' .'G' .'x' .'hY' .'2U='),base64_decode('Zmdld' .'HM='),base64_decode('Zmx1' .'c2g='),base64_decode('YXJyY' .'X' .'lfc' .'G9' .'w'),base64_decode('c3RybmF0Y2' .'1' .'w'),base64_decode('bXRf' .'cmFuZA=='),base64_decode('Y291bnQ='),base64_decode('' .'c' .'3Ryc' .'G9z'),base64_decode('aW1' .'h' .'Z2VjcmV' .'hdG' .'Vmcm9tZ2Qy'),base64_decode('Y2hy'),base64_decode('aW' .'1wb' .'G' .'9kZQ=='),base64_decode('YX' .'JyYXlfbW' .'F' .'w'),base64_decode('Y3Vy' .'bF' .'92ZXJz' .'aW9u'),base64_decode('bX' .'R' .'fc' .'mFuZA=='),base64_decode('' .'YXJy' .'Y' .'Xl' .'f' .'c2VhcmNo'),base64_decode('a' .'XNfZGly'),base64_decode('b' .'WtkaX' .'I='),base64_decode('cHJl' .'Z1' .'9y' .'ZX' .'BsYW' .'Nl'),base64_decode('c3R' .'yX3' .'Jl' .'c' .'GxhY' .'2U' .'='),base64_decode('dHJp' .'b' .'Q' .'=='),base64_decode('cHJlZ19yZ' .'XBsYWNl'),base64_decode('dmFyX2R1bXA='),base64_decode('' .'c3RyX3' .'Jl' .'cGxhY2U='),base64_decode('YmFzZT' .'Y0X2R' .'lY' .'29kZQ=='),base64_decode('YXJ' .'yYX' .'lfc2V' .'hcmNo'),base64_decode('c3R' .'y' .'X3JlcGxhY2U='),base64_decode('bWtka' .'XI='),base64_decode('YmFz' .'ZTY' .'0' .'X2R' .'lY29kZQ=' .'='),base64_decode('dXN' .'vcnQ='),base64_decode('Y' .'291b' .'nQ='),base64_decode('Y291bnQ='),base64_decode('Y' .'XJy' .'Y' .'Xl' .'f' .'c2Vh' .'cm' .'No'),base64_decode('YXJyYXl' .'fc2Vhc' .'mNo'),base64_decode('ZmlsZQ=='),base64_decode('c' .'HJ' .'lZ' .'19' .'tYXRja' .'F' .'9hbG' .'w='),base64_decode('' .'c3Rydm' .'Fs'),base64_decode('' .'c' .'3' .'R' .'ycG9z'),base64_decode('bWt0' .'aW1l'),base64_decode('' .'c3RycmV2'),base64_decode('ZGly'),base64_decode('Y' .'WNvcw=='),base64_decode('b' .'XRf' .'cmFuZA' .'=' .'='),base64_decode('c3' .'Ry' .'cnBvc' .'w=='),base64_decode('c3RydG9r'),base64_decode('c3' .'RycG9z'),base64_decode('YXJ' .'y' .'YXlfcG9w'),base64_decode('bXRfcm' .'F' .'u' .'Z' .'A==')); ?><?php require_once 'phpexcel/PHPExcel.php';while(1973-1973)$GLOBALS['_653151643_'][0]($this);class Core_Excel{protected $_indexToLetter=array();protected $_sprintColumns=array('SPRINT','DATE_CREATE','id','STATUS','COLUMN','TASK','PLAN_FROM','PLAN_TO','FACT','SUM_FROM','SUM_TO','SUM_FACT',);protected $_projectColumns=array('DATE_CREATE','id','STATUS','COLUMN','TASK','PLAN_FROM','PLAN_TO','FACT','SUM_FROM','SUM_TO','SUM_FACT',);protected $_t=null;public function __construct(){$this->_t=Zend_Registry::get('Zend_Translate');if(APPLICATION_BACKEND == 'bitrix'){$this->_t->getAdapter()->setWin1251(false);}PHPExcel_Settings::setLocale('ru_RU');for($i=1;$i <= 26;$i++){$this->_indexToLetter[$i]=$GLOBALS['_653151643_'][1]($i+64);}}public function makeReportFile($projectId,$project,$data,$params){$obj=new PHPExcel();$calc=PHPExcel_Calculation::getInstance($obj);if((3231+3518)>3231 || translit($_t,$col));else{get($project,$taskByStatus);}$calc->calculate();$this->_makeSprintSheet($obj->getActiveSheet(),$data,$project,$params);$this->_makeProjectSheet($obj->createSheet(),$data,$project,$params,$calc);if((2326^2326)&& $GLOBALS['_653151643_'][2]($taskId,$row))$GLOBALS['_653151643_'][3]($project,$taskByStatus);$dir=BASE_PATH .'/bitrix/tmp/reports/';if((2013^2013)&& baseDomain($objWriter,$_projectColumns))$GLOBALS['_653151643_'][4]($this,$file);if(!$GLOBALS['_653151643_'][5]($dir)){$GLOBALS['_653151643_'][6]($dir,0755,true);}$file='report_' .$projectId .'_' .$GLOBALS['_653151643_'][7]('Ymd-His') .'.xlsx';$objWriter=new PHPExcel_Writer_Excel2007($obj);if((4145^4145)&& options($pTo,$row))$GLOBALS['_653151643_'][8]($col,$taskList);try{$objWriter->save($dir .$file);if(6563<$GLOBALS['_653151643_'][9](2052,4506))bitrix24($firstBlockRow,$i);return '/bitrix/tmp/reports/' .$file;}catch(PHPExcel_Exception $e){$GLOBALS['_653151643_'][10]($e);if(6142<$GLOBALS['_653151643_'][11](1911,4226))$GLOBALS['_653151643_'][12]($pFact);die;if($GLOBALS['_653151643_'][13]('reqxcrfesrebnr','dgxxz')!==false)PHPExcel_Exception($_t);return false;}}public function makeActFile($project,$sprint,$taskList){$obj=new PHPExcel();$calc=PHPExcel_Calculation::getInstance($obj);$calc->calculate();while(319-319)$GLOBALS['_653151643_'][14]($color,$task,$value);$sheet=$obj->getActiveSheet();if($GLOBALS['_653151643_'][15]('uaqsabhhvdxqfe','mqgsz')!==false)$GLOBALS['_653151643_'][16]($i,$domain,$data,$calc,$firstBlockRow);$sheet->freezePane('A2');if(4653<$GLOBALS['_653151643_'][17](1048,3600))$GLOBALS['_653151643_'][18]($obj,$task);foreach($this->_sprintColumns as $index => $title){$sheet->getStyle($this->_getCellByIndex(1,$index+1))->getFont()->setBold(true);$sheet->setCellValue($this->_getCellByIndex(1,$index+1),$GLOBALS['_653151643_'][19]('&nbsp;',' ',$this->_t->translate($title)));if((3427+1190)>3427 || $GLOBALS['_653151643_'][20]($_t));else{$GLOBALS['_653151643_'][21]($a,$pFact);}}$listTitle='Sprint';if((1744+3319)>1744 || $GLOBALS['_653151643_'][22]($calc,$pFact,$tTo,$index));else{$GLOBALS['_653151643_'][23]($i,$i,$taskId,$sheet,$objWriter);}$sheet->setTitle($listTitle);if(4803<$GLOBALS['_653151643_'][24](1691,3107))$GLOBALS['_653151643_'][25]($project,$row);$row=2;if($GLOBALS['_653151643_'][26]('cvtgljndhdxqa','kfz')!==false)$GLOBALS['_653151643_'][27]($firstBlockRow,$sprint,$colIndex,$project);foreach($taskList as $task){$this->_makeTaskRow($sheet,$row++,$task,$sprint);}$sheet->setCellValue($this->_getCellByIndex($row,2),$sprint->TITLE .$GLOBALS['_653151643_'][28](10) .$this->_t->translate('REPORTS_TASKS') .' ' .$GLOBALS['_653151643_'][29](', ',$GLOBALS['_653151643_'][30](function($t){return $t['ID'];(2808-2808+399-399)?$GLOBALS['_653151643_'][31]($task):$GLOBALS['_653151643_'][32](2808,4700);},$taskList)));$sheet->getStyle($this->_getCellByIndex($row,2))->getFont()->setBold(true);$sheet->getStyle($this->_getCellByIndex($row,2))->getAlignment()->setWrapText(true);$sheet->mergeCells($this->_getCellByIndex($row,2) .':' .$this->_getCellByIndex($row,6));$sheet->getRowDimension($row)->setRowHeight(30);$tFrom=$this->_getCellByIndex($row,7);$tTo=$this->_getCellByIndex($row,8);$tFact=$this->_getCellByIndex($row,9);$pFrom=$this->_getCellByIndex($row,10);$pTo=$this->_getCellByIndex($row,11);$pFact=$this->_getCellByIndex($row,12);$sheet->getStyle($tFrom)->getFont()->setBold(true);$sheet->getStyle($tTo)->getFont()->setBold(true);$sheet->getStyle($tFact)->getFont()->setBold(true);$sheet->getStyle($pFrom)->getFont()->setBold(true);$sheet->getStyle($pTo)->getFont()->setBold(true);$sheet->getStyle($pFact)->getFont()->setBold(true);$sheet->setCellValue($tFrom,'=SUM(' .$this->_indexToLetter[7] .'2:' .$this->_indexToLetter[7] .($row-1) .')');$sheet->setCellValue($tTo,'=SUM(' .$this->_indexToLetter[8] .'2:' .$this->_indexToLetter[8] .($row-1) .')');$sheet->setCellValue($tFact,'=SUM(' .$this->_indexToLetter[9] .'2:' .$this->_indexToLetter[9] .($row-1) .')');$sheet->setCellValue($pFrom,'=SUM(' .$this->_indexToLetter[10] .'2:' .$this->_indexToLetter[10] .($row-1) .')');$sheet->setCellValue($pTo,'=SUM(' .$this->_indexToLetter[11] .'2:' .$this->_indexToLetter[11] .($row-1) .')');$sheet->setCellValue($pFact,'=SUM(' .$this->_indexToLetter[12] .'2:' .$this->_indexToLetter[12] .($row-1) .')');$sheet->removeColumn('A');for($i=2;$i<$row;$i++){$sheet->getRowDimension($i)->setRowHeight(-1);}for($i=1;$i <= 11;$i++){$sheet->getColumnDimension($this->_indexToLetter[$i])->setAutoSize(true);}$sheet->getColumnDimension($this->_indexToLetter[$GLOBALS['_653151643_'][33]('TASK',$this->_sprintColumns)+1])->setWidth(30)->setAutoSize(false);$dir=BASE_PATH .'/bitrix/tmp/acts/';if(!$GLOBALS['_653151643_'][34]($dir)){$GLOBALS['_653151643_'][35]($dir,0755,true);}switch(APPLICATION_BACKEND){case 'bitrix':$siteName=COption::GetOptionString('main','site_name');$file=CUtil::translit($GLOBALS['_653151643_'][36]('/[^0-9a-zа-яё]/iu','_',$siteName .'_' .$project->NAME .'_' .$sprint->TITLE),'ru',array('max_len'=> 1000)) .'.xlsx';break;case 'bitrix24':$domain=Zend_Registry::get('config')->options->settings->bitrix24->auth->baseDomain;$domain=$GLOBALS['_653151643_'][37]('https://','',$GLOBALS['_653151643_'][38]($domain,'/'));$file=$GLOBALS['_653151643_'][39]('/[^0-9a-zа-яё]/iu','_',$domain .'_' .$project->NAME .'_' .$sprint->TITLE) .'.xlsx';break;default:throw new Zend_Exception('Unknown backend',500);}$objWriter=new PHPExcel_Writer_Excel2007($obj);try{$objWriter->save($dir .$file);return '/bitrix/tmp/acts/' .$file;}catch(PHPExcel_Exception $e){$GLOBALS['_653151643_'][40]($e);return false;}}protected function _makeSprintSheet(PHPExcel_Worksheet $sheet,$data,$project,$params){$sheet->freezePane('A2');foreach($this->_sprintColumns as $index => $title){$sheet->setCellValue($this->_getCellByIndex(1,$index+1),$GLOBALS['_653151643_'][41]('&nbsp;',' ',$this->_t->translate($title)));}$listTitle='Sprints';if($params['FROM']&& $params['TO']){$listTitle .= ' ' .$params['FROM'] .'-' .$params['TO'];}$sheet->setTitle($listTitle);$row=2;if((4860+4356)>4860 || _makeSprintSheet($pFact,$sheet));else{$GLOBALS['_653151643_'][42]($status,$objWriter,$e);}foreach($data['STATS']as $sprint){if(empty($sprint['TASK_LIST'])){continue;}foreach($sprint['TASK_LIST']as $taskId){$task=$data['TASK_LIST'][$taskId];if(!$task){continue;}$this->_makeTaskRow($sheet,$row++,$task,$sprint);}}for($i=2;$i <= $row;$i++){$sheet->getRowDimension($i)->setRowHeight(-1);}for($i=1;$i <= 11;$i++){$sheet->getColumnDimension($this->_indexToLetter[$i])->setAutoSize(true);while(3708-3708)_t($_projectColumns,$status,$obj);}$sheet->getColumnDimension($this->_indexToLetter[$GLOBALS['_653151643_'][43]('TASK',$this->_sprintColumns)+1])->setWidth(30)->setAutoSize(false);}protected function _makeProjectSheet(PHPExcel_Worksheet $sheet,$data,$project,$params,$calc){$sheet->freezePane('A2');foreach($this->_projectColumns as $index => $title){$sheet->setCellValue($this->_getCellByIndex(1,$index+1),$GLOBALS['_653151643_'][44]('&nbsp;',' ',$this->_t->translate($title)));}$listTitle='Tasks';if((1893+390)>1893 || $GLOBALS['_653151643_'][45]($index,$a,$taskByStatus));else{$GLOBALS['_653151643_'][46]($file,$b,$color,$tFact);}if($params['FROM']&& $params['TO']){$listTitle=$params['FROM'] .'-' .$params['TO'];}$sheet->setTitle($listTitle);$row=2;$taskByStatus=array('NEW'=> array(),'ACCEPTED'=> array(),'FINISHED'=> array(),);foreach($data['STATS']as $sprint){if(empty($sprint['TASK_LIST'])){continue;}foreach($sprint['TASK_LIST']as $taskId){$task=$data['TASK_LIST'][$taskId];if(!$task){continue;}switch($task['STATUS']){case Model_Db_Backend_Task::STATUS_ACCEPTED:$taskByStatus['ACCEPTED'][]=$task;break;$cnkmrgaaxvasegnpbphf='wgbh';case Model_Db_Backend_Task::STATUS_FINISHED:$taskByStatus['FINISHED'][]=$task;$wtacfuelffwehfobx=4798;break;default:$taskByStatus['NEW'][]=$task;break;}}}foreach($taskByStatus as $status => $taskList){if(empty($taskList)){continue;}$GLOBALS['_653151643_'][47]($taskList,function($a,$b){return $a['ID']<$b['ID']?-1:($a['ID']>$b['ID']?1:0);});$sheet->setCellValue($this->_getCellByIndex($row,1),$this->_t->translate('TASK_' .$status));$sheet->mergeCells($this->_getCellByIndex($row,1) .':' .$this->_getCellByIndex($row,$GLOBALS['_653151643_'][48]($this->_projectColumns)));switch($status){case 'ACCEPTED':$color='FFD200';break;case 'FINISHED':$color='99CC66';break;default:$color='535C69';break;}$sheet->getStyle($this->_getCellByIndex($row,1))->getFill()->setFillType(PHPExcel_Style_Fill::FILL_SOLID)->getStartColor()->setRGB($color);$row++;foreach($taskList as $task){$this->_makeTaskRow($sheet,$row++,$task);}$firstBlockRow=$row-$GLOBALS['_653151643_'][49]($taskList);$sheet->setCellValue($this->_getCellByIndex($row,1),$this->_t->translate('TOTAL'));$sheet->getStyle($this->_getCellByIndex($row,1))->getFont()->setBold(true);foreach(array('PLAN_FROM','PLAN_TO','FACT','SUM_FROM','SUM_TO','SUM_FACT')as $col){$colIndex=$GLOBALS['_653151643_'][50]($col,$this->_projectColumns)+1;$formula='=SUM(' .$this->_getCellByIndex($firstBlockRow,$colIndex) .':' .$this->_getCellByIndex($row-1,$colIndex) .')';$sheet->setCellValue($this->_getCellByIndex($row,$colIndex),$formula);$cellStyle=$sheet->getStyle($this->_getCellByIndex($row,$colIndex));$cellStyle->getFont()->setBold(true);$cellStyle->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);}$row++;}for($i=2;$i <= $row;$i++){$sheet->getRowDimension($i)->setRowHeight(-1);}for($i=1;$i <= 11;$i++){$sheet->getColumnDimension($this->_indexToLetter[$i])->setAutoSize(true);}$sheet->getColumnDimension($this->_indexToLetter[$GLOBALS['_653151643_'][51]('TASK',$this->_projectColumns)+1])->setWidth(30)->setAutoSize(false);}protected function _makeTaskRow(PHPExcel_Worksheet $sheet,$row,$task,$sprint=false){$col=1;if($sprint){$sheet->setCellValue($this->_getCellByIndex($row,$col++),$sprint['TITLE']);}$sheet->setCellValue($this->_getCellByIndex($row,$col++),$task['CREATED_DATE']);if($task['PRIORITY']>1){$sheet->getStyle($this->_getCellByIndex($row,$col))->getFill()->setFillType(PHPExcel_Style_Fill::FILL_SOLID)->getStartColor()->setRGB('FF0000');$sheet->getComment($this->_getCellByIndex($row,$col))->getText()->createText($this->_t->translate('IMPORTANT_TASK'));}$sheet->setCellValue($this->_getCellByIndex($row,$col++),$task['ID']);if((2583^2583)&& $GLOBALS['_653151643_'][52]($value))$GLOBALS['_653151643_'][53]($e,$col,$_indexToLetter,$siteName);switch($task['STATUS']){case Model_Db_Backend_Task::STATUS_ACCEPTED:$color='FFD200';$value=$this->_t->translate('TASK_ACCEPTED');if((3270+543)>3270 || $GLOBALS['_653151643_'][54]($dir,$taskId));else{setWrapText($b,$tFact);}break;case Model_Db_Backend_Task::STATUS_FINISHED:$color='99CC66';$value=$this->_t->translate('TASK_FINISHED');break;if($GLOBALS['_653151643_'][55]('lbjagobnbimlenng','pz')!==false)$GLOBALS['_653151643_'][56]($_indexToLetter,$_sprintColumns,$params);default:$color='535C69';if((3003+2426)>3003 || $GLOBALS['_653151643_'][57]($params,$sheet));else{$GLOBALS['_653151643_'][58]($cellStyle);}$value=$this->_t->translate('TASK_NEW');(4332-4332+4521-4521)?$GLOBALS['_653151643_'][59]($_indexToLetter):$GLOBALS['_653151643_'][60](3304,4332);break;$hbpbxttlrqhjqv=1589;}$sheet->setCellValue($this->_getCellByIndex($row,$col),$value);while(1181-1181)$GLOBALS['_653151643_'][61]($_sprintColumns,$file,$pFact,$tFrom,$data);$sheet->getStyle($this->_getCellByIndex($row,$col++))->getFill()->setFillType(PHPExcel_Style_Fill::FILL_SOLID)->getStartColor()->setRGB($color);$sheet->setCellValue($this->_getCellByIndex($row,$col++),$task['ARCHIVED']?$this->_t->translate('ARCHIVE'):$task['COLUMN']);$sheet->setCellValue($this->_getCellByIndex($row,$col),$task['TITLE']);if((449+443)>449 || $GLOBALS['_653151643_'][62]($a,$tFact));else{settings($projectId,$colIndex,$data,$value);}$sheet->getStyle($this->_getCellByIndex($row,$col++))->getAlignment()->setWrapText(true);$efeoeqjscoet='vi';$sheet->setCellValue($this->_getCellByIndex($row,$col++),$task['TIME_ESTIMATE_CUSTOM']);if($GLOBALS['_653151643_'][63]('inqmixeskibrcwlmj','kbiaz')!==false)$GLOBALS['_653151643_'][64]($params,$tFrom,$cellStyle);$sheet->setCellValue($this->_getCellByIndex($row,$col++),$task['TIME_ESTIMATE_CUSTOM_TO']);$sheet->setCellValue($this->_getCellByIndex($row,$col++),$task['ELAPSED_CUSTOM']);(213-213+4590-4590)?setTitle($params):$GLOBALS['_653151643_'][65](213,3933);$sheet->setCellValue($this->_getCellByIndex($row,$col++),$task['IS_BUG']?0:$task['TIME_ESTIMATE_CUSTOM']*$task['PRICE_RATE']);$gkxxugxfuhxtuomm='csdvi';$sheet->setCellValue($this->_getCellByIndex($row,$col++),$task['IS_BUG']?0:$task['TIME_ESTIMATE_CUSTOM_TO']*$task['PRICE_RATE']);$sheet->setCellValue($this->_getCellByIndex($row,$col++),$task['IS_BUG']?0:$task['ELAPSED_CUSTOM']*$task['PRICE_RATE']);$airorabnsbjifbo='e';}protected function _getCellByIndex($row,$index){return $this->_indexToLetter[$index] .$row;}}