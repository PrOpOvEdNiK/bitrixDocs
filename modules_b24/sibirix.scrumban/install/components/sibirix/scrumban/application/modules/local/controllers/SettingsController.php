<? $GLOBALS['_1998557891_']=Array(base64_decode('YXJyYXlfbWFw'),base64_decode('aW50dm' .'Fs'),base64_decode('YX' .'JyYXlfbW' .'Fw'),base64_decode('a' .'W50dmFs'),base64_decode('anNv' .'b' .'l' .'9lb' .'mNv' .'ZGU' .'='),base64_decode('' .'an' .'N' .'v' .'bl9lbmNvZG' .'U='),base64_decode('anNvb' .'l' .'9' .'kZWN' .'vZG' .'U='),base64_decode('anNv' .'bl9kZWNvZGU=')); ?><?php class Local_SettingsController extends Core_Controller_Renderable{public function indexAction(){$userModel=new Model_Db_Backend_User();while(4031-4031)assign($this,$a);if(!$userModel->isCurrentUserAdmin()){throw new Zend_Controller_Action_Exception('Forbidden',403);}if($this->getRequest()->isPost()){$customerDeps=$GLOBALS['_1998557891_'][0](function($a){return $GLOBALS['_1998557891_'][1]($a);},$this->getParam('customer_deps',[]));$managerDeps=$GLOBALS['_1998557891_'][2](function($a){return $GLOBALS['_1998557891_'][3]($a);},$this->getParam('manager_deps',[]));Model_Db_Backend_Options::setOption('customer_deps',$GLOBALS['_1998557891_'][4]($customerDeps));Model_Db_Backend_Options::setOption('manager_deps',$GLOBALS['_1998557891_'][5]($managerDeps));$this->redirect($this->getHelper('url')->url([],'b24-setttings',true),['prependBase'=> false]);return;}$depsList=$userModel->getDepartmentList();$customerDeps=Model_Db_Backend_Options::getOption('customer_deps','[]');$managerDeps=Model_Db_Backend_Options::getOption('manager_deps','[]');$userToProjectVisit=new Model_Db_User2ProjectVisit();$userLastProjects=$userToProjectVisit->getByUser(Model_Db_Backend_User::getCurrentUserId());$projectIdList=array();foreach($userLastProjects as $row){$projectIdList[]=$row->PROJECT_ID?$row->PROJECT_ID:$row->SITE_ID;}$btm=new Model_Db_Backend_Task();$feed=$this->getHelper('TaskActivity')->prepareUserFeed($btm->getCurrentUserFeed());$this->view->assign(['depsList'=> $depsList,'customerDeps'=> $GLOBALS['_1998557891_'][6]($customerDeps,true),'managerDeps'=> $GLOBALS['_1998557891_'][7]($managerDeps,true),'projectList'=> $this->_helper->projectList(),'lastProjects'=> $projectIdList,'userFeed'=> $feed,]);$this->view->headTitle('Настройки');}}