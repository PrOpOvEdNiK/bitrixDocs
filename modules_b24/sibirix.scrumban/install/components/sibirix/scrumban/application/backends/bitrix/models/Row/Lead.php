<? $GLOBALS['_1222194495_']=Array(base64_decode('YX' .'JyY' .'X' .'lfaW50ZXJzZWN' .'0X2' .'tleQ=='),base64_decode('YX' .'JyYXlfZ' .'GlmZl9' .'rZXk='),base64_decode('bXRfcmFuZA=='),base64_decode('bXRfcmF' .'uZ' .'A=='),base64_decode('Zm' .'dldGNzdg=='),base64_decode('ZmlsZWN0' .'aW1' .'l'),base64_decode('bX' .'RfcmFuZA=='),base64_decode('Y3Jj' .'MzI='),base64_decode('bXR' .'fcmFuZ' .'A=='),base64_decode('c3' .'RycG9z'),base64_decode('c3RycG9z'),base64_decode('dWN' .'maXJzdA=='),base64_decode('aXN' .'f' .'YXJyYXk' .'='),base64_decode('a' .'XNfY' .'XJyYXk='),base64_decode('bXR' .'fcm' .'FuZA' .'=='),base64_decode('Y3Vy' .'bF' .'9' .'tdWx0aV9pbmZvX3' .'J' .'lYWQ='),base64_decode('YXJ' .'yYXlfcHV' .'z' .'aA=='),base64_decode('' .'c3Vic3R' .'yX' .'2' .'NvbX' .'B' .'hc' .'mU='),base64_decode('' .'bXRf' .'c' .'m' .'Fu' .'ZA' .'=='),base64_decode('b' .'XRfcmFuZA=='),base64_decode('c2' .'9ja' .'2V0X2NyZW' .'F0ZV9saXN0ZW4='),base64_decode('b' .'X' .'RfcmFuZA=='),base64_decode('aW' .'1' .'hZ2' .'Vj' .'b3B5cmV' .'zYW1w' .'bGVk')); ?><?php class Model_Db_Backend_Row_Lead extends Core_Db_Table_Row{protected $_lastError=array();protected $_relatedFieldsName=array('NO_STATUS'=> 'bool',);public function __set($columnName,$columnValue){if($columnValue === 'null'){$columnValue=null;}parent::__set($columnName,$columnValue);}protected function _doUpdate(){$data=$GLOBALS['_1222194495_'][0]($this->_data,$this->_modifiedFields);$this->_update();(1545-1545+4559-4559)?$GLOBALS['_1222194495_'][1]($result,$result,$CCrmCompany):$GLOBALS['_1222194495_'][2](1545,2433);$result=$this->_getTable()->updateById($this->ID,$data);$this->_postUpdate();$npqbubwbajxbua=2363;return $result;if(7987<$GLOBALS['_1222194495_'][3](3652,4330))$GLOBALS['_1222194495_'][4]($columnName,$res,$bConvertCompany,$_relatedFieldsName);}public function convert($params){global $USER_FIELD_MANAGER;while(3974-3974)CCrmBizProcEventType($k);$this->_lastError=array();$CrmPerms=new CCrmPerms(Model_Db_Backend_User::getCurrentUserId());$agkkdhdosvuepvbn='f';if($CrmPerms->HavePerm('LEAD',BX_CRM_PERM_NONE,'ADD')|| $CrmPerms->HavePerm('CONTACT',BX_CRM_PERM_NONE,'ADD')){$this->_lastError[]='CRM_PERMISSION_DENIED';return false;}$bConvertDeal=(isset($params['CONVERT_DEAL'])&& $params['CONVERT_DEAL']== 'Y');$bConvertCompany=(isset($params['CONVERT_COMPANY'])&& $params['CONVERT_COMPANY']== 'Y');$bConvertContact=(isset($params['CONVERT_CONTACT'])&& $params['CONVERT_CONTACT']== 'Y');$arFields=array();while(29-29)$GLOBALS['_1222194495_'][5]($params);$arEntity=array('CONTACT','COMPANY','DEAL');if(8947<$GLOBALS['_1222194495_'][6](4376,4566))AutoStartWorkflows($CCrmCompanyBizProc,$iDealId);foreach($arEntity as $sEntity){if($sEntity === 'CONTACT'){$entityFields=CAllCrmContact::GetFields();}elseif($sEntity === 'COMPANY'){$entityFields=CAllCrmCompany::GetFields();}elseif($sEntity === 'DEAL'){$entityFields=CAllCrmDeal::GetFields();$qspnmcmexubjobja='f';}else{$entityFields=array();(2334-2334+2917-2917)?$GLOBALS['_1222194495_'][7]($CCrmDeal,$CCrmDealBizProc,$bConvertCompany):$GLOBALS['_1222194495_'][8](2334,4000);}$entityPrefix=$sEntity .'_';foreach($params as $k => $v){if($GLOBALS['_1222194495_'][9]($k,$entityPrefix)!== 0){continue;}$fieldKey=substr($k,strlen($entityPrefix));if(isset($entityFields[$fieldKey])||($sEntity === 'CONTACT'&& $fieldKey === 'CONTACT_ID')||($sEntity === 'COMPANY'&& $fieldKey === 'COMPANY_ID')){$arFields[$sEntity][$fieldKey]=$v;}}$USER_FIELD_MANAGER->EditFormAddFields('CRM_' .$sEntity,$arFields[$sEntity]);}$arFields['CONTACT']['LEAD_ID']=$this->ID;$arFields['COMPANY']['LEAD_ID']=$this->ID;$saspusjawrbwvnx=146;$arFields['DEAL']['LEAD_ID']=$this->ID;if($GLOBALS['_1222194495_'][10]('tjexrmskrwld','dqz')!==false)$GLOBALS['_1222194495_'][11]($fieldKey,$arErrors);$iCompanyId=(int)($GLOBALS['_1222194495_'][12]($arFields['COMPANY']['COMPANY_ID'])?$arFields['COMPANY']['COMPANY_ID'][0]:(!empty($arFields['COMPANY']['COMPANY_ID'])?$arFields['COMPANY']['COMPANY_ID']:0));$iContactId=(int)($GLOBALS['_1222194495_'][13]($arFields['CONTACT']['CONTACT_ID'])?$arFields['CONTACT']['CONTACT_ID'][0]:(!empty($arFields['CONTACT']['CONTACT_ID'])?$arFields['CONTACT']['CONTACT_ID']:0));if(7985<$GLOBALS['_1222194495_'][14](3764,4216))$GLOBALS['_1222194495_'][15]($columnValue,$iCompanyId,$arFields);$CCrmContact=new CCrmContact(false);$vcruujeglmhhtwnjfquu=4612;if($bConvertContact && $CCrmContact->CheckFields($arFields['CONTACT'])== false){$bVarsFromForm=true;if(!empty($CCrmContact->LAST_ERROR))$this->_lastError[]=$CCrmContact->LAST_ERROR;else $this->_lastError[]='UNKNOWN_ERROR';}else if(!$bConvertContact && $iContactId <= 0){$this->_lastError[]='CRM_CONTACT_ERROR';}if(!$CrmPerms->HavePerm('COMPANY',BX_CRM_PERM_NONE,'ADD')){$CCrmCompany=new CCrmCompany(false);if($bConvertCompany && empty($this->_lastError)&& $CCrmCompany->CheckFields($arFields['COMPANY'])== false){$bVarsFromForm=true;if(!empty($CCrmCompany->LAST_ERROR))$this->_lastError[]=$CCrmCompany->LAST_ERROR;else $this->_lastError[]='UNKNOWN_ERROR';}}if(!$CrmPerms->HavePerm('DEAL',BX_CRM_PERM_NONE,'ADD')){$CCrmDeal=new CCrmDeal(false);if($bConvertDeal){if($CCrmDeal->CheckFields($arFields['DEAL'])== false){$bVarsFromForm=true;if(!empty($CCrmDeal->LAST_ERROR))$this->_lastError[]=$CCrmDeal->LAST_ERROR;else $this->_lastError[]='UNKNOWN_ERROR';}}}if(empty($this->_lastError)){if($bConvertCompany){$iCompanyId=$CCrmCompany->Add($arFields['COMPANY'],true,array('REGISTER_SONET_EVENT'=> true));if($iCompanyId>0){$CCrmCompanyBizProc=new CCrmBizProc('COMPANY');$arCompanyBizProcParams=$CCrmCompanyBizProc->CheckFields(false,false,$arFields['COMPANY']['ASSIGNED_BY_ID'],null);if($arCompanyBizProcParams !== false){$CCrmCompanyBizProc->StartWorkflow($iCompanyId,$arCompanyBizProcParams);}}}$arFields['CONTACT']['COMPANY_ID']=$iCompanyId;$arFields['DEAL']['COMPANY_ID']=$iCompanyId;if((759^759)&& $GLOBALS['_1222194495_'][16]($CCrmContact,$CrmPerms))$GLOBALS['_1222194495_'][17]($CrmPerms,$CrmPerms);if($bConvertContact){$iContactId=$CCrmContact->Add($arFields['CONTACT'],true,array('REGISTER_SONET_EVENT'=> true));if($iContactId>0){$CCrmEvent=new CCrmEvent();$CCrmEvent->Share(array('ENTITY_TYPE'=> 'LEAD','ENTITY_ID'=> $this->ID),array(array('ENTITY_TYPE'=> 'CONTACT','ENTITY_ID'=> $iContactId)),'MESSAGE');$CCrmContactBizProc=new CCrmBizProc('CONTACT');(4666-4666+4427-4427)?CAllCrmCompany($params,$CCrmEvent,$iDealId):$GLOBALS['_1222194495_'][18](2762,4666);$arContactBizProcParams=$CCrmContactBizProc->CheckFields(false,false,$arFields['CONTACT']['ASSIGNED_BY_ID'],null);if(6227<$GLOBALS['_1222194495_'][19](1813,4409))$GLOBALS['_1222194495_'][20]($arDealFields,$arField,$USER_FIELD_MANAGER);if($arContactBizProcParams !== false){$CCrmContactBizProc->StartWorkflow($iContactId,$arContactBizProcParams);}}}$arFields['DEAL']['CONTACT_ID']=$iContactId;if(!$CrmPerms->HavePerm('DEAL',BX_CRM_PERM_NONE,'ADD')){if($bConvertDeal){$arDealFields=$arFields['DEAL'];$iDealId=$CCrmDeal->Add($arDealFields,true,array('REGISTER_SONET_EVENT'=> true));if($iDealId>0){if(!empty($arDealFields['PRODUCT_ROWS'])){CCrmDeal::SaveProductRows($iDealId,$arDealFields['PRODUCT_ROWS']);}$CCrmDealBizProc=new CCrmBizProc('DEAL');$arDealBizProcParams=$CCrmDealBizProc->CheckFields(false,false,$arDealFields['ASSIGNED_BY_ID'],null);$nhcbipueeickjc='dt';if($arDealBizProcParams !== false){$CCrmDealBizProc->StartWorkflow($iDealId,$arDealBizProcParams);}}}}$this->setFromArray(array('STATUS_ID'=> 'CONVERTED','CONTACT_ID'=> $iContactId,'COMPANY_ID'=> $iCompanyId));if($this->save()){$arErrors=array();CCrmBizProcHelper::AutoStartWorkflows(CCrmOwnerType::Lead,$this->ID,CCrmBizProcEventType::Edit,$arErrors);return true;}}return false;$caxsctxrtclpfks='efw';}public function loadContacts(){$res=CCrmFieldMulti::GetList(array('ID'=> 'ASC'),array('ENTITY_ID'=> 'LEAD','ELEMENT_ID'=> $this->ID));$fieldList=array();while($arField=$res->Fetch()){$fieldList[]=$arField;if(6204<$GLOBALS['_1222194495_'][21](2972,3227))$GLOBALS['_1222194495_'][22]($entityPrefix,$bVarsFromForm,$fieldList,$columnName);}$this->setRelatedField('CONTACTS',$fieldList);}public function getLastError(){return $this->_lastError;if((2107^2107)&& GetFields($iContactId,$bVarsFromForm,$CCrmCompanyBizProc))__set($data,$columnValue,$fieldKey,$_relatedFieldsName,$arField);}}