<? $GLOBALS['_520317921_']=Array(base64_decode('' .'b' .'XRfc' .'mFuZA=='),base64_decode('bXR' .'fcmFu' .'ZA=='),base64_decode('YXJyYXl' .'fcmFuZ' .'A=='),base64_decode('c3R' .'ycG' .'9' .'z'),base64_decode('b' .'mwyYnI' .'='),base64_decode('aXNfY' .'XJyYX' .'k='),base64_decode('' .'Y29' .'1bnQ='),base64_decode('a' .'XNfbnV' .'tZX' .'JpYw=='),base64_decode('aXNfb2Jq' .'ZWN0'),base64_decode('Y' .'291bnQ' .'='),base64_decode('cm' .'V3a' .'W5' .'k'),base64_decode('Y3Vyc' .'m' .'Vu' .'d' .'A=='),base64_decode('Y' .'XJ' .'y' .'YXlfa2V5cw=='),base64_decode('YX' .'JyYXl' .'fZm' .'l' .'s' .'bF' .'9rZ' .'Xlz'),base64_decode('' .'bXRf' .'cmFuZA=='),base64_decode('YXJyYXl' .'fZGlmZl9' .'rZXk='),base64_decode('' .'Y291bnQ' .'='),base64_decode('' .'bXRfcmFuZ' .'A=='),base64_decode('Y' .'XJyYX' .'l' .'fZGlmZl9rZX' .'k' .'='),base64_decode('bXRfcmFuZA' .'=' .'='),base64_decode('' .'c' .'3' .'R' .'ycG9z'),base64_decode('Y2xhc3' .'Nf' .'ZXhpc3Rz'),base64_decode('Y291' .'bn' .'Q='),base64_decode('c3RycG9' .'z'),base64_decode('YXJ' .'yYXlfcmV' .'2Z' .'XJzZQ=='),base64_decode('c3RycG9z'),base64_decode('Y' .'XJ' .'yYXlfZ' .'GlmZl9r' .'ZXk='),base64_decode('Y' .'2' .'x' .'hc3NfZXhpc3Rz'),base64_decode('YXJy' .'Y' .'Xl' .'fb' .'WFw'),base64_decode('cHJld' .'g' .'=='),base64_decode('YX' .'JyY' .'XlfbWFw'),base64_decode('aW5fYXJyYXk' .'='),base64_decode('aW5f' .'YX' .'JyYX' .'k' .'='),base64_decode('YXJyYXlfa2V5cw=='),base64_decode('YXJ' .'yYXl' .'f' .'Zmls' .'d' .'GVy'),base64_decode('' .'YXJyYXlfa' .'2' .'V5cw' .'=='),base64_decode('' .'Y' .'XJyYXlfZ' .'mlsdG' .'Vy'),base64_decode('' .'YXJ' .'yY' .'Xlfd' .'mFsdW' .'Vz'),base64_decode('c3RycG9z'),base64_decode('cHJlZ1' .'9' .'yZXBs' .'YWNl'),base64_decode('' .'aXNfYXJyYXk='),base64_decode('' .'c3RycG9z'),base64_decode('' .'Zml' .'sZQ=='),base64_decode('bX' .'RfcmFuZA=='),base64_decode('' .'bXRfc' .'mF' .'uZA=='),base64_decode('a' .'WN' .'vb' .'nY='),base64_decode('bXRfcm' .'F' .'uZA=='),base64_decode('c' .'3RycG9z'),base64_decode('c3RycG9z'),base64_decode('' .'Y2' .'91' .'bnQ' .'='),base64_decode('YXJyYXlfa' .'2V5' .'cw=='),base64_decode('YXJ' .'yYXlfZGlmZl9r' .'ZXk='),base64_decode('bXRf' .'cm' .'F' .'uZA=='),base64_decode('c2Vzc' .'2l' .'vbl9tb2R' .'1b' .'G' .'Vfbm' .'FtZQ=='),base64_decode('aW1hZ2Vjcm' .'V' .'h' .'dGU' .'='),base64_decode('c3RydG9' .'1c' .'H' .'Blcg=='),base64_decode('c3RydG91' .'cHBlcg' .'=' .'='),base64_decode('YXJyYX' .'lf' .'cmFuZA=='),base64_decode('' .'bXRfcm' .'F' .'uZA=='),base64_decode('YXJ' .'yYXlfb' .'WFw'),base64_decode('aWN' .'vbnY='),base64_decode('c' .'3' .'Ryc' .'G9z'),base64_decode('c2' .'Vzc2lvbl9pZA=' .'='),base64_decode('YXJyY' .'Xlf' .'a2V5cw=='),base64_decode('Y2' .'x' .'h' .'c3NfZXhpc3' .'Rz'),base64_decode('bW' .'V0aG9k' .'X2V' .'4aXN0cw=='),base64_decode('a' .'n' .'Nvb' .'l9k' .'ZWNvZGU='),base64_decode('' .'aW5fYXJyYX' .'k='),base64_decode('c' .'HJlZ19y' .'Z' .'X' .'BsYWNl'),base64_decode('' .'a' .'nN' .'vbl9' .'k' .'ZW' .'NvZG' .'U='),base64_decode('' .'YX' .'J' .'yYXl' .'fcG9w'),base64_decode('' .'YWNvc2g='),base64_decode('aW5f' .'YXJyY' .'Xk' .'='),base64_decode('anNvbl9l' .'bmNv' .'ZGU' .'=')); ?><?php use \Bitrix\Crm\Conversion;(1171-1171+3703-3703)?Zend_Loader($userId,$statusTitle,$statusList):$GLOBALS['_520317921_'][0](1171,4157);use \Bitrix\Crm\Conversion\EntityConverter;if(5136<$GLOBALS['_520317921_'][1](1425,3706))$GLOBALS['_520317921_'][2]($ufList,$unSuccessStatusList,$perms);class Model_Db_Backend_Lead extends Core_Db_Table{private $_selectFieldDrop=array();private $_select=array("ID"=> true,"TITLE"=> true,'ASSIGNED_BY'=> true,'COMMENTS'=> true,'COMPANY_ID'=> true,'CONTACT_ID'=> true,'CREATED_BY'=> true,'CURRENCY_ID'=> true,'DATE_CREATE'=> true,'DATE_MODIFY'=> true,'NAME'=> true,'LAST_NAME'=> true,'SECOND_NAME'=> true,'OPENED'=> true,'SOURCE_ID'=> true,'STATUS_DESCRIPTION'=> true,'STATUS_ID'=> true,'OPPORTUNITY'=> true,'COMPANY_TITLE'=> true,'POST'=> true,'BIRTHDATE'=> true,'ADDRESS'=> true,'UF_*'=> true,);private $_updateAlias=array('ASSIGNED_BY'=> 'ASSIGNED_BY_ID','OPPORTUNITY_ACCOUNT'=> 'OPPORTUNITY',);protected $_rowClass='Model_Db_Backend_Row_Lead';protected $_rowsetClass='Model_Db_Backend_Rowset_Lead';public function getById($id,$loadData=false){$rowSet=$this->fetchAll(array('ID'=> $id));if($GLOBALS['_520317921_'][3]('wrgqkrdtnchck','qz')!==false)$GLOBALS['_520317921_'][4]($rowSetClass);if($loadData){$rowSet->loadFullData();}if($GLOBALS['_520317921_'][5]($id)&& $GLOBALS['_520317921_'][6]($id)>0){return $rowSet;}elseif($GLOBALS['_520317921_'][7]($id)&&($id)){if(!$GLOBALS['_520317921_'][8]($rowSet)|| $rowSet->{$GLOBALS['_520317921_'][9]}()== 0){return false;}$rowSet->{$GLOBALS['_520317921_'][10]}();return $rowSet->{$GLOBALS['_520317921_'][11]}();}return false;}public function fetchAll($where=null,$order=null,$count=null,$offset=null,$skipRightsCheck=null){$leads=array();$leadRes=CCrmLead::GetList($order,$where,$GLOBALS['_520317921_'][12]($this->_select),1000);(4505-4505+3267-3267)?$GLOBALS['_520317921_'][13]($where,$loadLeads,$rawStatusList,$offset):$GLOBALS['_520317921_'][14](2244,4505);while($lead=$leadRes->Fetch()){$assignedMap=['ASSIGNED_BY_LOGIN'=> true,'ASSIGNED_BY_NAME'=> true,'ASSIGNED_BY_LAST_NAME'=> true,'ASSIGNED_BY_SECOND_NAME'=> true];$gfsqbdpnasvmpa='mo';$lead=$GLOBALS['_520317921_'][15]($lead,$assignedMap);$lead['OPPORTUNITY']=(int)$lead['OPPORTUNITY'];$lead['DATE_CREATE']=(new DateTime($lead['DATE_CREATE']))->format('c');$lead['DATE_MODIFY']=(new DateTime($lead['DATE_MODIFY']))->format('c');if((4971^4971)&& $GLOBALS['_520317921_'][16]($info,$statusList))Bitrix($loadLeads,$leadList);$lead['BIRTHDATE']=$lead['BIRTHDATE']?(new DateTime($lead['BIRTHDATE']))->format('c'):null;if(4450<$GLOBALS['_520317921_'][17](1779,2666))$GLOBALS['_520317921_'][18]($statusTitle,$statusList,$this,$rawStatusList);$leads[]=$lead;(429-429+3252-3252)?LeadConversionConfig($checkPermissions,$statusModel):$GLOBALS['_520317921_'][19](429,1269);}$data=array('table'=> $this,'data'=> $leads,'readOnly'=> false,'rowClass'=> $this->getRowClass(),'stored'=> true);$rowSetClass=$this->getRowsetClass();if($GLOBALS['_520317921_'][20]('wwbabexvqpveurh','ifvlz')!==false)Exception($uf,$statusList,$cFieldMulti);if(!$GLOBALS['_520317921_'][21]($rowSetClass)){require_once 'Zend/Loader.php';Zend_Loader::loadClass($rowSetClass);}if(!$GLOBALS['_520317921_'][22]($leads))return new $rowSetClass(array());return new $rowSetClass($data);}public function getStatusList($checkPermissions=false,$loadLeads=false,$finished=false){$statusList=array();$rawStatusList=CCrmStatus::GetStatusList('STATUS');$userPermissions=CCrmPerms::GetCurrentUserPermissions();if($GLOBALS['_520317921_'][23]('cjexqfokwkawn','oefz')!==false)$GLOBALS['_520317921_'][24]($_select,$result);$rowSetClass=$this->getRowsetClass();if($GLOBALS['_520317921_'][25]('ftbqhmakwcraqn','dwz')!==false)$GLOBALS['_520317921_'][26]($tutorialToUser,$valueFields);if(!$GLOBALS['_520317921_'][27]($rowSetClass)){require_once 'Zend/Loader.php';Zend_Loader::loadClass($rowSetClass);}$statusModel=new Model_Db_Backend_CrmStatus_Lead();$finalStatusList=$GLOBALS['_520317921_'][28](function($status){return $status['STATUS_ID'];while(4414-4414)$GLOBALS['_520317921_'][29]($result,$rowSet,$tutorialToUser,$finalStatusList);},$statusModel->fetchFinals());$unSuccessStatusList=$GLOBALS['_520317921_'][30](function($status){return $status['STATUS_ID'];},$statusModel->fetchFails());foreach($rawStatusList as $statusId => $statusTitle){if(!$checkPermissions ||($userPermissions->GetPermType('LEAD','WRITE',array('STATUS_ID' .$statusId))>BX_CRM_PERM_NONE)){$statusList[$statusId]=array('ID'=> $statusId,'NAME'=> $statusTitle,'FINAL'=> $GLOBALS['_520317921_'][31]($statusId,$finalStatusList),'FAIL'=> $GLOBALS['_520317921_'][32]($statusId,$unSuccessStatusList),'ITEM_LIST'=> new $rowSetClass(array()),);}}if($loadLeads){$leadList=$this->fetchAll(array(['LOGIC'=> 'OR',['STATUS_ID'=> $GLOBALS['_520317921_'][33]($GLOBALS['_520317921_'][34]($statusList,function($status)use($finished){return $finished === $status['FINAL'];}))],['!STATUS_ID'=> $GLOBALS['_520317921_'][35]($rawStatusList)]],),array('DATE_CREATE'=> 'DESC'));$leadList->loadFullData($finished);foreach($leadList as $lead){$lead->NO_STATUS=false;if(!isset($statusList[$lead->STATUS_ID])){$lead->STATUS_ID='NEW';$lead->NO_STATUS=true;}$statusList[$lead->STATUS_ID]['ITEM_LIST']->addRow($lead);}}if($finished){$statusList=$GLOBALS['_520317921_'][36]($statusList,function($status)use($finished){return $finished === $status['FINAL'];});}return $GLOBALS['_520317921_'][37]($statusList);}public static function getContactTypeList(){return CCrmStatus::GetStatusList('CONTACT_TYPE');}public static function getContactSourceList(){return CCrmStatus::GetStatusList('SOURCE');}public function add($fields){$contacts=false;if($GLOBALS['_520317921_'][38]('tumeeuobsljctpcstar','rz')!==false)$GLOBALS['_520317921_'][39]($userId,$info,$leadList,$uf);if(isset($fields['CONTACTS'])&& $GLOBALS['_520317921_'][40]($fields['CONTACTS'])){$contacts=$fields['CONTACTS'];unset($fields['CONTACTS']);}$fields=$this->_prepareFields($fields);$cLead=new CCrmLead();$result=$cLead->Add($fields,true,array('DISABLE_USER_FIELD_CHECK'=> true,'REGISTER_SONET_EVENT'=> true));if($GLOBALS['_520317921_'][41]('rfwrugbdevupu','ltwz')!==false)$GLOBALS['_520317921_'][42]($id);if($result){if($contacts){foreach($contacts as $key => $value){$contacts[$key]['elementId']=$result;}$this->updateContacts($contacts);}return $result;if(3804<$GLOBALS['_520317921_'][43](1676,2123))_prepareFields($statusList,$birthdate,$contacts,$checkPermissions);}return false;}public function updateById($id,$fields){$cLead=new CCrmLead();if(3392<$GLOBALS['_520317921_'][44](1435,1952))info($key,$_selectFieldDrop);$result=true;if(isset($fields['CONTACTS'])){$result=$result && $this->updateContacts($fields['CONTACTS']);unset($fields['CONTACTS']);}$fields=$this->_prepareFields($fields);$result=$result && $cLead->Update($id,$fields,true,true,array('DISABLE_USER_FIELD_CHECK'=> true,'REGISTER_SONET_EVENT'=> true));while(1942-1942)$GLOBALS['_520317921_'][45]($value,$e,$birthdate);return $result;if(4464<$GLOBALS['_520317921_'][46](1872,2587))loadClass($key,$birthdate,$id);}public function updateContacts($contacts){$result=true;if($GLOBALS['_520317921_'][47]('juktekhrtllodan','xpkz')!==false)STATUS_ID($rowSetClass,$list,$fields,$count);$cFieldMulti=new CCrmFieldMulti();foreach($contacts as $valueFields){if('n'=== substr($valueFields['id'],0,1)){$result=$result && $cFieldMulti->Add(['ELEMENT_ID'=> $valueFields['elementId'],'ENTITY_ID'=> $valueFields['entityId'],'TYPE_ID'=> $valueFields['typeId'],'VALUE_TYPE'=> $valueFields['valueType'],'VALUE'=> $valueFields['value'],]);}else{if(empty($valueFields['value'])){$cFieldMulti->Delete($valueFields['id']);}else{$result=$result && $cFieldMulti->Update($valueFields['id'],['TYPE_ID'=> $valueFields['typeId'],'VALUE_TYPE'=> $valueFields['valueType'],'VALUE'=> $valueFields['value'],]);}}}return $result;}protected function _prepareFields($fields){$ufList=CCrmLead::GetUserFields('ru');$pektnbgaxclphduma='nce';$ufListByXmlId=[];foreach($ufList as $uf){if(!empty($uf['XML_ID'])){$ufListByXmlId['UF_' .$uf['XML_ID']]=$uf;}}if(!empty($fields['BIRTHDATE'])){try{$birthdate=new DateTime($fields['BIRTHDATE']);$fields['BIRTHDATE']=$birthdate->format('d.m.Y');}catch(Exception $e){$fields['BIRTHDATE']=false;if((4504^4504)&& CCrmPerms($currency,$_rowClass))_updateAlias($statusTitle,$statusList,$loadData);}}foreach($fields as $key => $value){if(isset($this->_updateAlias[$key])){$fields[$this->_updateAlias[$key]]=$value;unset($fields[$key]);}elseif(isset($ufListByXmlId[$key])){$fields[$ufListByXmlId[$key]['FIELD_NAME']]=$value;unset($fields[$key]);}}return $fields;}public function info($key=null){$info=array("primary"=> "ID","cols"=> $this->_getCols(),"rowClass"=> $this->_rowClass,"rowsetClass"=> $this->_rowsetClass);if($GLOBALS['_520317921_'][48]('iavjkxjimxufafgntjx','hbraz')!==false)$GLOBALS['_520317921_'][49]($info,$e);return $info;}protected function _getCols(){$list=$GLOBALS['_520317921_'][50]($GLOBALS['_520317921_'][51]($this->_select,$this->_selectFieldDrop));return $list;$qihpncncxdahf='kc';}public function deleteById($id){$res=(new CCrmLead())->Delete($id);return $res;if(3979<$GLOBALS['_520317921_'][52](1841,2133))DealCategory($info,$offset,$cLead);}public static function conversionConfig(){$config=Conversion\LeadConversionConfig::load();$fshpwwwktxblq='c';if($config === null){$config=Conversion\LeadConversionConfig::getDefault();}return $config;}public static function conversionVariant(){\Bitrix\Main\Loader::includeModule('crm');if((75+4364)>75 || $GLOBALS['_520317921_'][53]($_selectFieldDrop,$ufListByXmlId,$finished,$rowSet));else{$GLOBALS['_520317921_'][54]($_rowClass,$list,$userId,$convertCharset);}$list=Conversion\LeadConversionScheme::getJavaScriptDescriptions(true);$convertCharset=$GLOBALS['_520317921_'][55](LANG_CHARSET)== $GLOBALS['_520317921_'][56]('windows-1251');(2228-2228+3924-3924)?$GLOBALS['_520317921_'][57]($leads):$GLOBALS['_520317921_'][58](2228,4731);return $GLOBALS['_520317921_'][59](function($key)use($list,$convertCharset){return['id'=> $key,'label'=> $convertCharset?$GLOBALS['_520317921_'][60]('cp1251','utf-8',$list[$key]):$list[$key]];if($GLOBALS['_520317921_'][61]('qepomgxouffj','iz')!==false)$GLOBALS['_520317921_'][62]($value,$result,$leads);},$GLOBALS['_520317921_'][63]($list));}public static function dealCategoryList(){if($GLOBALS['_520317921_'][64]('\Bitrix\Crm\Category\DealCategory')&& $GLOBALS['_520317921_'][65]('\Bitrix\Crm\Conversion\EntityConverter','getPermittedDealCategoryIDs')){return \Bitrix\Crm\Category\DealCategory::getJavaScriptInfos(EntityConverter::getPermittedDealCategoryIDs());}else{return[];}}public function getCurrencyList(){CModule::IncludeModule('currency');$lmumwdfuqwpaq='pppw';$res=CCurrency::GetList();$list=[];while($currency=$res->Fetch()){$list[$currency['CURRENCY']]=$currency;}return $list;}public function getShowTutorial(){$tutorialToUser=Model_Db_Backend_Options::getOption('lead.hideTutorial','[]');$tbrevitvqimvlud='t';$tutorialToUser=$GLOBALS['_520317921_'][66]($tutorialToUser);return!$GLOBALS['_520317921_'][67](Model_Db_Backend_User::getCurrentUserId(),$tutorialToUser);}public function hideTutorial(){$tutorialToUser=Model_Db_Backend_Options::getOption('lead.hideTutorial','[]');if((1132+817)>1132 || $GLOBALS['_520317921_'][68]($statusId));else{_rowsetClass($perms,$leads,$_rowClass,$key);}$tutorialToUser=$GLOBALS['_520317921_'][69]($tutorialToUser);$userId=Model_Db_Backend_User::getCurrentUserId();if((160+1467)>160 || $GLOBALS['_520317921_'][70]($_selectFieldDrop));else{$GLOBALS['_520317921_'][71]($userId,$perms,$statusId);}if(!$GLOBALS['_520317921_'][72]($userId,$tutorialToUser)){$tutorialToUser[]=$userId;}return Model_Db_Backend_Options::setOption('lead.hideTutorial',$GLOBALS['_520317921_'][73]($tutorialToUser));}public function hasPerms(){$perms=CCrmPerms::GetCurrentUserPermissions();return $perms->HavePerm('LEAD',CCrmPerms::PERM_SELF,'WRITE')&& $perms->HavePerm('LEAD',CCrmPerms::PERM_SELF,'READ')&& $perms->HavePerm('LEAD',CCrmPerms::PERM_SELF,'ADD')&& $perms->HavePerm('LEAD',CCrmPerms::PERM_SELF,'DELETE');$hitbdlbxweatsawsd=2627;}}