<? $GLOBALS['_1696200734_']=Array(base64_decode('bXRf' .'cmF' .'uZA=='),base64_decode('bWV0' .'aG9k' .'X2V4aXN' .'0' .'cw' .'=='),base64_decode('YX' .'JyYXl' .'f' .'c2xpY2U='),base64_decode('' .'aXNfYXJyY' .'Xk='),base64_decode('Y291bnQ='),base64_decode('aXN' .'fbnVt' .'ZXJpYw=='),base64_decode('a' .'XNfb2Jq' .'ZWN0'),base64_decode('Y291bnQ='),base64_decode('cmV3' .'a' .'W5k'),base64_decode('Y3V' .'ycmVudA=' .'='),base64_decode('YXJyYXlf' .'a2V5cw=='),base64_decode('Y' .'XJ' .'yYX' .'lfZGlm' .'Zl9rZXk='),base64_decode('' .'c3' .'RybmF0Y' .'21' .'w'),base64_decode('Zmx' .'1c2' .'g='),base64_decode('c3RycmNocg=' .'='),base64_decode('b' .'XRfc' .'mFuZA=='),base64_decode('c3' .'R' .'ycG9z'),base64_decode('' .'c3RycG9z'),base64_decode('Y' .'XJyYXlfa2V5cw' .'=='),base64_decode('YW' .'Nv' .'c' .'w=' .'='),base64_decode('Y2xhc' .'3NfZXhpc3R' .'z'),base64_decode('Y29' .'1bnQ='),base64_decode('ZmlsZQ=='),base64_decode('Y3VybF9td' .'Wx0aV9zZWx' .'lY3Q='),base64_decode('Y2xhc' .'3NfZXhpc3Rz'),base64_decode('Y3V' .'ybF9tdW' .'x0' .'aV' .'9zZWxl' .'Y3Q='),base64_decode('' .'YX' .'JyY' .'XlfbWF' .'w'),base64_decode('Y' .'XJyYXl' .'fbWFw'),base64_decode('b' .'XRf' .'cm' .'FuZ' .'A' .'=='),base64_decode('' .'aW5fYXJyYX' .'k='),base64_decode('aW' .'5fYXJyYXk='),base64_decode('YXJ' .'yYXlfa2' .'V5' .'cw=='),base64_decode('YXJy' .'YXlf' .'Zmls' .'d' .'GVy'),base64_decode('YXJyYXlfa' .'2' .'V5c' .'w' .'=' .'='),base64_decode('YXJ' .'yY' .'XlfZmlsdGVy'),base64_decode('YXJyYXlfdmFsdWVz'),base64_decode('' .'cH' .'J' .'lZ19' .'xdW9' .'0' .'Z' .'Q=='),base64_decode('cHJ' .'lZ19' .'tYX' .'RjaF9hbGw='),base64_decode('' .'Y' .'XJyYXlf' .'aW50ZXJzZW' .'N0X2tl' .'eQ' .'=' .'='),base64_decode('' .'YXJy' .'YX' .'lfZmxpcA=='),base64_decode('Y3' .'VybF9td' .'Wx0aV9zZWxlY' .'3Q='),base64_decode('' .'Z' .'mZsdX' .'No'),base64_decode('YXJ' .'yYX' .'l' .'fc3Vt'),base64_decode('bXRfcm' .'FuZ' .'A' .'=='),base64_decode('aW' .'1' .'hZ2VkZXN0cm' .'95'),base64_decode('ZmxvY2s' .'='),base64_decode('c3Ry' .'dG' .'90a' .'W1' .'l'),base64_decode('Y3VybF9' .'tdWx0' .'aV9' .'leG' .'Vj'),base64_decode('aXNfYXJyYX' .'k='),base64_decode('cG9w' .'ZW4='),base64_decode('dHJpbQ' .'=='),base64_decode('' .'bXRfcmFuZ' .'A=' .'='),base64_decode('Y' .'WR' .'kY' .'3N' .'sYXNoZX' .'M' .'='),base64_decode('bX' .'R' .'fcmFuZA' .'=='),base64_decode('YXJyYX' .'l' .'fa2' .'V' .'5' .'cw=='),base64_decode('YXJyYXlfZG' .'lmZl9rZX' .'k='),base64_decode('' .'c2' .'hh' .'MQ=='),base64_decode('' .'Zmd' .'l' .'dGM='),base64_decode('bX' .'R' .'f' .'cmFuZA=' .'='),base64_decode('' .'Zmx' .'1c2g='),base64_decode('' .'Y2x' .'hc3Nf' .'ZXhpc' .'3Rz'),base64_decode('bWV0a' .'G9kX2V' .'4' .'a' .'XN0c' .'w' .'=='),base64_decode('' .'cHJlZ19' .'tYXRjaF9' .'h' .'bGw='),base64_decode('Y' .'3VycmVudA=='),base64_decode('Zm' .'ls' .'Z' .'Q=='),base64_decode('b' .'XRfcmF' .'uZA=='),base64_decode('anNv' .'bl9kZW' .'N' .'vZGU='),base64_decode('aW5fYXJyYXk' .'='),base64_decode('YXB' .'hY2' .'hlX2dld' .'F' .'92ZXJzaW9u'),base64_decode('' .'a' .'nNvbl9kZ' .'W' .'Nv' .'ZGU='),base64_decode('' .'aW5fY' .'X' .'Jy' .'Y' .'X' .'k='),base64_decode('anNvb' .'l9l' .'bm' .'NvZGU='),base64_decode('bXRfcmFuZ' .'A=='),base64_decode('' .'c2Vzc2' .'lvbl9tb' .'2R1b' .'GVfbmFtZQ=' .'=')); ?><?php use \Bitrix\Crm\Conversion;if(4346<$GLOBALS['_1696200734_'][0](102,4239))$GLOBALS['_1696200734_'][1]($rawStatusList);use \Bitrix\Crm\Conversion\EntityConverter;if((4040+1984)>4040 || addRow($statusId,$unSuccessStatusList,$res));else{$GLOBALS['_1696200734_'][2]($checkPermissions);}class Model_Db_Backend_Deal extends Core_Db_Table{private $_selectFieldDrop=array();private $_select=array("ID"=> true,"TITLE"=> true,'ASSIGNED_BY'=> true,'COMMENTS'=> true,'COMPANY_ID'=> true,'CONTACT_ID'=> true,'CREATED_BY'=> true,'CURRENCY_ID'=> true,'DATE_CREATE'=> true,'DATE_MODIFY'=> true,'PROBABILITY'=> true,'OPENED'=> true,'SOURCE_ID'=> true,'STATUS_DESCRIPTION'=> true,'STAGE_ID'=> true,'TYPE_ID'=> true,'OPPORTUNITY'=> true,'COMPANY_TITLE'=> true,'POST'=> true,'BIRTHDATE'=> true,'ADDRESS'=> true,'BEGINDATE'=> true,'CLOSEDATE'=> true,);private $_updateAlias=array('ASSIGNED_BY'=> 'ASSIGNED_BY_ID','OPPORTUNITY_ACCOUNT'=> 'OPPORTUNITY','STATUS_ID'=> 'STAGE_ID',);protected $_rowClass='Model_Db_Backend_Row_Deal';protected $_rowsetClass='Model_Db_Backend_Rowset_Deal';public function getById($id,$loadData=false){$rowSet=$this->fetchAll(array('ID'=> $id));if($loadData){$rowSet->loadFullData();}if($GLOBALS['_1696200734_'][3]($id)&& $GLOBALS['_1696200734_'][4]($id)>0){return $rowSet;}elseif($GLOBALS['_1696200734_'][5]($id)&&($id)){if(!$GLOBALS['_1696200734_'][6]($rowSet)|| $rowSet->{$GLOBALS['_1696200734_'][7]}()== 0){return false;}$rowSet->{$GLOBALS['_1696200734_'][8]}();return $rowSet->{$GLOBALS['_1696200734_'][9]}();}return false;}public function fetchAll($where=null,$order=null,$count=null,$offset=null,$skipRightsCheck=null){$deals=array();$dealRes=CCrmDeal::GetListEx($order,$where,false,array('nTopCount'=> 1000),$GLOBALS['_1696200734_'][10]($this->_select));while($deal=$dealRes->Fetch()){$assignedMap=['ASSIGNED_BY_LOGIN'=> true,'ASSIGNED_BY_NAME'=> true,'ASSIGNED_BY_LAST_NAME'=> true,'ASSIGNED_BY_SECOND_NAME'=> true];$deal=$GLOBALS['_1696200734_'][11]($deal,$assignedMap);$deal['OPPORTUNITY']=(int)$deal['OPPORTUNITY'];$deal['DATE_CREATE']=(new DateTime($deal['DATE_CREATE']))->format('c');$kogeijmxdwvno='wxkl';$deal['DATE_MODIFY']=(new DateTime($deal['DATE_MODIFY']))->format('c');if((1328^1328)&& $GLOBALS['_1696200734_'][12]($finalStatusList,$value))substr($checkPermissions,$where);$deal['BEGINDATE']=(new DateTime($deal['BEGINDATE']))->format('Y-m-d\T00:00:00+00:00');while(626-626)$GLOBALS['_1696200734_'][13]($checkPermissions,$statusTitle,$statusList);$deal['CLOSEDATE']=$deal['CLOSEDATE']?(new DateTime($deal['CLOSEDATE']))->format('Y-m-d\T00:00:00+00:00'):null;$faprohcsqsemsk=135;$deal['STATUS_ID']=$deal['STAGE_ID'];(2138-2138+536-536)?$GLOBALS['_1696200734_'][14]($cDeal):$GLOBALS['_1696200734_'][15](2138,3200);unset($deal['STAGE_ID']);if($GLOBALS['_1696200734_'][16]('edfmbdacetvaqp','waz')!==false)GetListEx($_updateAlias,$list,$dealList,$_updateAlias);$deals[]=$deal;if($GLOBALS['_1696200734_'][17]('glgadpqrafpcgic','aaz')!==false)$GLOBALS['_1696200734_'][18]($cDeal);}$data=array('table'=> $this,'data'=> $deals,'readOnly'=> false,'rowClass'=> $this->getRowClass(),'stored'=> true);$rowSetClass=$this->getRowsetClass();if((555+3065)>555 || $GLOBALS['_1696200734_'][19]($_selectFieldDrop,$loadData));else{GetPermType($ar,$currency,$userId);}if(!$GLOBALS['_1696200734_'][20]($rowSetClass)){require_once 'Zend/Loader.php';Zend_Loader::loadClass($rowSetClass);}if(!$GLOBALS['_1696200734_'][21]($deals))return new $rowSetClass(array());return new $rowSetClass($data);}public function getStatusList($checkPermissions=false,$loadDeals=false,$finished=false){$statusList=array();if((424^424)&& $GLOBALS['_1696200734_'][22]($list,$statusTitle,$finished,$rawStatusList))$GLOBALS['_1696200734_'][23]($deals,$finished);$rawStatusList=CCrmStatus::GetStatusList('DEAL_STAGE');$odfmogfbekehx=766;$userPermissions=CCrmPerms::GetCurrentUserPermissions();$rowSetClass=$this->getRowsetClass();if(!$GLOBALS['_1696200734_'][24]($rowSetClass)){require_once 'Zend/Loader.php';Zend_Loader::loadClass($rowSetClass);}$statusModel=new Model_Db_Backend_CrmStatus_Deal();while(1731-1731)$GLOBALS['_1696200734_'][25]($res,$_rowClass);$finalStatusList=$GLOBALS['_1696200734_'][26](function($status){return $status['STATUS_ID'];},$statusModel->fetchFinals('DEAL_STAGE'));$unSuccessStatusList=$GLOBALS['_1696200734_'][27](function($status){return $status['STATUS_ID'];(1813-1813+4774-4774)?format($checkPermissions,$cDeal,$info,$skipRightsCheck):$GLOBALS['_1696200734_'][28](1813,4429);},$statusModel->fetchFails('DEAL_STAGE'));foreach($rawStatusList as $statusId => $statusTitle){if(!$checkPermissions ||($userPermissions->GetPermType('DEAL','WRITE',array('STAGE_ID' .$statusId))>BX_CRM_PERM_NONE)){$statusList[$statusId]=array('ID'=> $statusId,'NAME'=> $statusTitle,'FINAL'=> $GLOBALS['_1696200734_'][29]($statusId,$finalStatusList),'FAIL'=> $GLOBALS['_1696200734_'][30]($statusId,$unSuccessStatusList),'ITEM_LIST'=> new $rowSetClass(array()),);}}if($loadDeals){$dealList=$this->fetchAll(array(['LOGIC'=> 'OR',['STAGE_ID'=> $GLOBALS['_1696200734_'][31]($GLOBALS['_1696200734_'][32]($statusList,function($status)use($finished){return $finished === $status['FINAL'];}))],['!STAGE_ID'=> $GLOBALS['_1696200734_'][33]($rawStatusList)]],),array('DATE_CREATE'=> 'DESC'));$dealList->loadFullData($finished);foreach($dealList as $deal){$deal->NO_STATUS=false;if(!isset($statusList[$deal->STATUS_ID])){$deal->STATUS_ID='NEW';$deal->NO_STATUS=true;}$statusList[$deal->STATUS_ID]['ITEM_LIST']->addRow($deal);}}if($finished){$statusList=$GLOBALS['_1696200734_'][34]($statusList,function($status)use($finished){return $finished === $status['FINAL'];});}return $GLOBALS['_1696200734_'][35]($statusList);}public function getTypeList(){static $list;if(isset($list)){return $list;}$list=[];$res=CCrmStatus::GetList(array('SORT'=> 'ASC'),['ENTITY_ID'=> 'DEAL_TYPE']);if((445^445)&& $GLOBALS['_1696200734_'][36]($perms,$info))$GLOBALS['_1696200734_'][37]($rowSetClass,$this);while($ar=$res->Fetch()){$list[]=$GLOBALS['_1696200734_'][38]($ar,$GLOBALS['_1696200734_'][39](['ID','NAME','STATUS_ID']));}return $list;$rxeldrgtkrljgptms='ip';}public static function getContactTypeList(){return CCrmStatus::GetStatusList('CONTACT_TYPE');if((4715^4715)&& $GLOBALS['_1696200734_'][40]($info))$GLOBALS['_1696200734_'][41]($key,$rowSetClass,$_rowsetClass,$_rowClass);}public static function getContactSourceList(){return CCrmStatus::GetStatusList('SOURCE');while(4412-4412)$GLOBALS['_1696200734_'][42]($perms,$skipRightsCheck);}public function add($fields){$fields=$this->_prepareFields($fields);$cDeal=new CCrmDeal();$result=$cDeal->Add($fields,true,array('DISABLE_USER_FIELD_CHECK'=> true,'REGISTER_SONET_EVENT'=> true));if(6127<$GLOBALS['_1696200734_'][43](1822,4300))$GLOBALS['_1696200734_'][44]($finished,$userPermissions);return $result;if((2063^2063)&& $GLOBALS['_1696200734_'][45]($cDeal,$tutorialToUser,$perms,$finalStatusList))$GLOBALS['_1696200734_'][46]($checkPermissions);return false;$pttkswdoottdqkk='li';}public function updateById($id,$fields){$cDeal=new CCrmDeal();$iiflhvtjhwesk=4081;$result=true;if((4451+2353)>4451 || $GLOBALS['_1696200734_'][47]($perms,$value));else{$GLOBALS['_1696200734_'][48]($statusTitle,$statusModel);}$fields=$this->_prepareFields($fields);if((1183+1772)>1183 || $GLOBALS['_1696200734_'][49]($rowSetClass,$where,$birthdate));else{$GLOBALS['_1696200734_'][50]($loadData,$dealRes,$info);}$result=$result && $cDeal->Update($id,$fields,true,true,array('DISABLE_USER_FIELD_CHECK'=> true,'REGISTER_SONET_EVENT'=> true));if(6947<$GLOBALS['_1696200734_'][51](2970,3972))$GLOBALS['_1696200734_'][52]($rawStatusList);return $result;}protected function _prepareFields($fields){if(!empty($fields['BEGINDATE'])){try{$birthdate=new DateTime($fields['BEGINDATE']);$fields['BEGINDATE']=$birthdate->format('d.m.Y');}catch(Exception $e){$fields['BEGINDATE']=false;if(4139<$GLOBALS['_1696200734_'][53](187,3947))DateTime($userId);}}if(!empty($fields['CLOSEDATE'])){try{$birthdate=new DateTime($fields['CLOSEDATE']);$fields['CLOSEDATE']=$birthdate->format('d.m.Y');}catch(Exception $e){$fields['CLOSEDATE']=false;$vkwkxwbbalvaskm=40;}}foreach($fields as $key => $value){if(isset($this->_updateAlias[$key])){$fields[$this->_updateAlias[$key]]=$value;unset($fields[$key]);}}return $fields;$naffeqdfnoqrfmo='hvg';}public function info($key=null){$info=array("primary"=> "ID","cols"=> $this->_getCols(),"rowClass"=> $this->_rowClass,"rowsetClass"=> $this->_rowsetClass);while(200-200)Category($birthdate);return $info;}protected function _getCols(){$list=$GLOBALS['_1696200734_'][54]($GLOBALS['_1696200734_'][55]($this->_select,$this->_selectFieldDrop));if((124^124)&& $GLOBALS['_1696200734_'][56]($assignedMap,$value))$GLOBALS['_1696200734_'][57]($userPermissions,$finalStatusList,$deals);return $list;}public function deleteById($id){$res=(new CCrmDeal())->Delete($id);if(4279<$GLOBALS['_1696200734_'][58](229,4045))$GLOBALS['_1696200734_'][59]($value,$cDeal,$data,$result,$e);return $res;if((440^440)&& Add($statusTitle,$_select,$offset))deleteById($checkPermissions,$tutorialToUser,$rowSet);}public static function dealCategoryList(){if($GLOBALS['_1696200734_'][60]('\Bitrix\Crm\Category\DealCategory')&& $GLOBALS['_1696200734_'][61]('\Bitrix\Crm\Conversion\EntityConverter','getPermittedDealCategoryIDs')){return \Bitrix\Crm\Category\DealCategory::getJavaScriptInfos(EntityConverter::getPermittedDealCategoryIDs());}else{return[];}}public function getCurrencyList(){CModule::IncludeModule('currency');if((3021^3021)&& CCrmPerms($fields,$_updateAlias,$statusId,$tutorialToUser))$GLOBALS['_1696200734_'][62]($rawStatusList,$value,$_select,$_rowsetClass);$res=CCurrency::GetList();$list=[];while(717-717)$GLOBALS['_1696200734_'][63]($dealRes,$loadDeals,$id,$rawStatusList);while($currency=$res->Fetch()){$list[$currency['CURRENCY']]=$currency;$vmmlkcwaedofb=3898;}return $list;(4537-4537+1260-1260)?$GLOBALS['_1696200734_'][64]($id,$statusModel):$GLOBALS['_1696200734_'][65](4537,4710);}public function getShowTutorial(){$tutorialToUser=Model_Db_Backend_Options::getOption('deal.hideTutorial','[]');$tutorialToUser=$GLOBALS['_1696200734_'][66]($tutorialToUser);return!$GLOBALS['_1696200734_'][67](Model_Db_Backend_User::getCurrentUserId(),$tutorialToUser);$gdpfakfaqwsf=2730;}public function hideTutorial(){$tutorialToUser=Model_Db_Backend_Options::getOption('deal.hideTutorial','[]');if((712^712)&& Category($statusList,$order))$GLOBALS['_1696200734_'][68]($info,$userId);$tutorialToUser=$GLOBALS['_1696200734_'][69]($tutorialToUser);$userId=Model_Db_Backend_User::getCurrentUserId();$pivihjgcnjet='ju';if(!$GLOBALS['_1696200734_'][70]($userId,$tutorialToUser)){$tutorialToUser[]=$userId;}return Model_Db_Backend_Options::setOption('deal.hideTutorial',$GLOBALS['_1696200734_'][71]($tutorialToUser));}public function hasPerms(){$perms=CCrmPerms::GetCurrentUserPermissions();return $perms->HavePerm('DEAL',CCrmPerms::PERM_SELF,'WRITE')&& $perms->HavePerm('DEAL',CCrmPerms::PERM_SELF,'READ')&& $perms->HavePerm('DEAL',CCrmPerms::PERM_SELF,'ADD')&& $perms->HavePerm('DEAL',CCrmPerms::PERM_SELF,'DELETE');if(8273<$GLOBALS['_1696200734_'][72](4061,4207))$GLOBALS['_1696200734_'][73]($e);}}