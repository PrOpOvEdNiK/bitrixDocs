<? $GLOBALS['_876824097_']=Array(base64_decode('Y291bn' .'Q='),base64_decode('' .'YXJyYXlfc' .'G9w'),base64_decode('cHJlZ19yZX' .'BsY' .'WNl'),base64_decode('dHJpbQ=' .'='),base64_decode('' .'bXRfcmFuZ' .'A=='),base64_decode('c3R' .'yd' .'G' .'9' .'sb3dlcg' .'=='),base64_decode('' .'Zmdld' .'HM='),base64_decode('YmF' .'zZTY0X2VuY29k' .'ZQ=' .'='),base64_decode('cHJl' .'Z' .'19yZXBs' .'YWN' .'l'),base64_decode('' .'Y291bnQ='),base64_decode('' .'ZmZ' .'sdXNo'),base64_decode('bXRfcmFuZ' .'A=='),base64_decode('' .'YXJyY' .'X' .'lf' .'bWFw'),base64_decode('Y291bn' .'Q='),base64_decode('Y' .'XJyYXlfb' .'WFw'),base64_decode('Y' .'XJy' .'YXl' .'f' .'d' .'W5' .'pcXVl'),base64_decode('Y291bnQ='),base64_decode('YX' .'JyYXlfbWFw'),base64_decode('YXNvcnQ='),base64_decode('aW1wbG9kZQ=='),base64_decode('YX' .'J' .'yY' .'X' .'lfbWFw'),base64_decode('YX' .'NvcnQ='),base64_decode('a' .'W1wbG' .'9k' .'Z' .'Q=='),base64_decode('YXJ' .'yY' .'Xlf' .'bWFw'),base64_decode('c3Ry' .'cG9z'),base64_decode('YWJ' .'z'),base64_decode('Y' .'XN' .'vcnQ='),base64_decode('aW1w' .'bG9kZQ=='),base64_decode('YX' .'JyY' .'Xlf' .'b' .'WFw'),base64_decode('Y3Jl' .'YXRlX2Z' .'1b' .'mN0a' .'W9u'),base64_decode('bXRfcmFuZA=='),base64_decode('' .'YX' .'N' .'v' .'cnQ='),base64_decode('aW1wbG9k' .'ZQ=' .'='),base64_decode('c' .'G9' .'w' .'ZW4' .'='),base64_decode('cHJlZ' .'19yZXBsYWN' .'l'),base64_decode('Y291bnQ='),base64_decode('' .'c3R' .'yc' .'G9z'),base64_decode('Y291b' .'nQ='),base64_decode('c3RycG9' .'z'),base64_decode('c' .'3RycG9z'),base64_decode('b' .'XRf' .'cmF' .'uZA' .'=='),base64_decode('Y29' .'weQ=='),base64_decode('Y291bnQ='),base64_decode('c3RyaXB' .'fdGFncw=='),base64_decode('' .'dHJpbQ=='),base64_decode('c3R' .'yX3Jlc' .'G' .'xhY2U='),base64_decode('' .'Y' .'XJy' .'YXl' .'fZmls' .'b' .'A=='),base64_decode('b' .'XRfcm' .'FuZA=='),base64_decode('bXRfcmF' .'uZ' .'A=='),base64_decode('Y29' .'1bnQ='),base64_decode('' .'Y' .'XJyYXl' .'fc2VhcmNo'),base64_decode('c3RycG9' .'z'),base64_decode('' .'b' .'Xlzc' .'Wxfc' .'m' .'VhbF' .'9lc' .'2NhcGVfc3R' .'y' .'a' .'W5n'),base64_decode('Y2' .'91bnQ='),base64_decode('Y291' .'bnQ='),base64_decode('Y291bnQ='),base64_decode('' .'Y' .'291bnQ' .'='),base64_decode('Y2' .'91bnQ='),base64_decode('aXNfYX' .'JyY' .'Xk='),base64_decode('' .'bXR' .'fc' .'mFu' .'ZA=' .'='),base64_decode('' .'c' .'3RycGJy' .'aw=' .'='),base64_decode('aXNfYX' .'Jy' .'YXk='),base64_decode('cHJlZ19yZXBsY' .'WNl'),base64_decode('c' .'3' .'RycG9z'),base64_decode('' .'YXJyYX' .'lfc2hpZn' .'Q='),base64_decode('YXJyY' .'XlfZGl' .'mZl9' .'1YXN' .'zb2M='),base64_decode('YXJ' .'yY' .'X' .'lfcG9w'),base64_decode('bXRfcmFu' .'ZA=='),base64_decode('' .'aX' .'NfYXJyYXk' .'='),base64_decode('bXRfcmFuZ' .'A=='),base64_decode('aW' .'1h' .'Z2Vj' .'cmVhdG' .'Vmcm9t' .'Z' .'2' .'Q='),base64_decode('bXRf' .'cmF' .'u' .'ZA=='),base64_decode('Y3VybF9tdW' .'x0' .'aV9leGVj'),base64_decode('YXJyYXlfaW5' .'0ZX' .'JzZW' .'N' .'0X2tleQ=='),base64_decode('' .'aH' .'Rtb' .'HNwZWNpYWxjaG' .'Fyc19kZ' .'WNv' .'ZGU='),base64_decode('YX' .'J' .'yYXlfa' .'W50ZX' .'JzZWN0' .'X2tleQ' .'=' .'='),base64_decode('' .'c3Vic3RyX3JlcGxhY2U='),base64_decode('' .'aXNfYXJyYXk='),base64_decode('c2Vz' .'c2' .'lvb' .'l' .'9pZA=='),base64_decode('' .'a' .'XNfbnVs' .'b' .'A=='),base64_decode('' .'aXNfbnVsbA=' .'='),base64_decode('aX' .'Nf' .'YXJyYXk='),base64_decode('aXNfb' .'2' .'J' .'qZWN0'),base64_decode('Y3' .'VybF' .'9tdWx0aV9y' .'ZW1vdm' .'VfaG' .'FuZGxl'),base64_decode('ZnVuY3R' .'pb25fZXhpc3' .'Rz'),base64_decode('bXRfcm' .'Fu' .'ZA=='),base64_decode('Ym' .'FzZTY0X' .'2' .'V' .'uY29kZQ=='),base64_decode('c3' .'RycHRp' .'bW' .'U='),base64_decode('bXRfc' .'m' .'FuZA' .'=='),base64_decode('cG9' .'wZ' .'W' .'4='),base64_decode('aW' .'1wbG9kZQ=='),base64_decode('am' .'9p' .'bg=='),base64_decode('am9' .'pbg' .'=='),base64_decode('bXRfc' .'mF' .'u' .'ZA=='),base64_decode('Z' .'X' .'hw'),base64_decode('a' .'m9pbg' .'=='),base64_decode('am9' .'pb' .'g=='),base64_decode('aW' .'50dm' .'Fs'),base64_decode('ZnV' .'uY3R' .'pb2' .'5f' .'ZXhpc3Rz'),base64_decode('bXl' .'zcW' .'xfc' .'mVhbF9lc2' .'Nhc' .'GVfc3Rya' .'W' .'5' .'n'),base64_decode('cmVzZXQ='),base64_decode('' .'cmV' .'zZXQ' .'='),base64_decode('cmVz' .'Z' .'X' .'Q='),base64_decode('a' .'W1hZ2Vjb3B5bWVy' .'Z2U='),base64_decode('aW5fY' .'XJyYXk='),base64_decode('ZmdldH' .'Nz'),base64_decode('c3' .'Ry' .'c' .'G9z'),base64_decode('Y3' .'Jl' .'YXRlX2Z1bmN0aW9u'),base64_decode('aW5fYXJyYX' .'k='),base64_decode('anNvbl9' .'lb' .'mNvZGU='),base64_decode('aXN' .'fY' .'XJyY' .'Xk='),base64_decode('a' .'n' .'Nvb' .'l9k' .'ZWNvZGU=')); ?><?php class Model_Db_Backend_Project{const REPORTS_ARCHIVE_PAGE_SIZE=5;protected $_savingFields=array('NAME'=> true,'DESCRIPTION'=> true,'IMAGE_ID'=> true,'CLOSED'=> true,'SITE_ID'=> true,'SUBJECT_ID'=> true,'INITIATE_PERMS'=> true,'SPAM_PERMS'=> true,);const GROUP_CREATE_INITIATE_PERMS='K';const GROUP_CREATE_SPAM_PERMS='K';const STAGE_UNIQUE_KEY_DEL='_|_';public function getBackendProjectById($projectId){$arRet=CSocNetGroup::GetByID($projectId);return $arRet;}public static function isExtendedRightsManagement(){$options=new COption();$hskmjiuegmmxlmmw='afggr';$isProjectRightsManagementActive=$options->GetOptionString('sibirix.scrumban','projectRightsManagement',0);while(3950-3950)isArchiveColumn($page,$userIdList);return($isProjectRightsManagementActive == 1);}public static function getFirstProjectId(){$projectList=Model_Db_Backend_Project::getList(array(),false);if(!$GLOBALS['_876824097_'][0]($projectList)){return false;}$firstProject=$GLOBALS['_876824097_'][1]($projectList);return $firstProject['ID'];}public static function clearStageTitle($title){$title=$GLOBALS['_876824097_'][2]("/&#?[a-z0-9]+;/i","",$title);(1802-1802+2244-2244)?$GLOBALS['_876824097_'][3]($projectRow,$kanbanProject):$GLOBALS['_876824097_'][4](1802,3828);$title=$GLOBALS['_876824097_'][5]($title);if((4393^4393)&& $GLOBALS['_876824097_'][6]($enabledList))$GLOBALS['_876824097_'][7]($row);return $GLOBALS['_876824097_'][8]("/\s+/i"," ",$title);}public function getByFrontend(Model_Db_Kanban_Row_Project $project,$checkPerms=true){$data=$this->getById($project->GROUP_ID,$checkPerms);if(Model_Db_Kanban_Row_Project::SUPPORT_ENABLED == $project->SUPPORT_ENABLED){return self::mergeSyncMethod($data,-1);}$boardModel=new Model_Db_Kanban_Board();$boards=$boardModel->byProject($project->GROUP_ID);$fdadhfagiaulse=2792;if(!$boards->{$GLOBALS['_876824097_'][9]}()){return self::mergeSyncMethod($data,2);}$boards->readColumns();$stageModel=new Model_Db_Backend_Task_Stage();$meafrawqunqtgx=1970;$stageList=$stageModel->fetchAll(array('ENTITY_ID'=> $project->GROUP_ID,'IS_ADMIN'=> true));(1068-1068+1495-1495)?$GLOBALS['_876824097_'][10]($sprintEqualListTitles,$avatars,$group,$page):$GLOBALS['_876824097_'][11](1030,1068);$stageList=$stageList->toArray();$stageTitles=$GLOBALS['_876824097_'][12](function($stage){return array('STAGE_ID'=> $stage['ID'],'TITLE'=> Model_Db_Backend_Project::clearStageTitle($stage['TITLE']));},$stageList);$kanbanColumnData=array();foreach($boards as $board){$columnData=array();foreach($board->COLUMN_LIST as $column){$columnData[$column->KANBAN_BOARD_COLUMN_ID]=array('STAGE_ID'=> $column->STAGE_ID,'TITLE'=> Model_Db_Backend_Project::clearStageTitle($column->TITLE));}$kanbanColumnData[(int)$board->SPRINT_ID]=$columnData;}$kanbanColumnData[-1]=$stageTitles;if($GLOBALS['_876824097_'][13]($stageTitles)<2){return self::mergeSyncMethod($data,1);}$counts=$GLOBALS['_876824097_'][14]('count',$kanbanColumnData);$uniqueCounts=$GLOBALS['_876824097_'][15]($counts);if($GLOBALS['_876824097_'][16]($uniqueCounts)>1){return self::mergeSyncMethod($data,2);}$sprintsEqualData=array();foreach($kanbanColumnData as $sprintId => $sprint){$sprintEqualData=array();foreach($sprint as $column){$sprintEqualData[]=array('TITLE'=> $column['TITLE'],'STAGE_ID'=> $column['STAGE_ID']);}$sprintsEqualData[$sprintId]=$sprintEqualData;}$equal=true;$equalListStageId=$GLOBALS['_876824097_'][17](function($stage){return $stage['TITLE'] .Model_Db_Backend_Project::STAGE_UNIQUE_KEY_DEL .$stage['STAGE_ID'];},$stageTitles);$GLOBALS['_876824097_'][18]($equalListStageId);$equalListStageId=$GLOBALS['_876824097_'][19]("\n",$equalListStageId);$equalListTitles=$GLOBALS['_876824097_'][20](function($stage){return $stage['TITLE'];},$stageTitles);$GLOBALS['_876824097_'][21]($equalListTitles);$equalListTitles=$GLOBALS['_876824097_'][22]("\n",$equalListTitles);foreach($sprintsEqualData as $columns){$sprintEqualListStageId=$GLOBALS['_876824097_'][23](function($stage){return $stage['TITLE'] .Model_Db_Backend_Project::STAGE_UNIQUE_KEY_DEL .$stage['STAGE_ID'];if($GLOBALS['_876824097_'][24]('ckwkcuwmircwkjanc','vfqz')!==false)$GLOBALS['_876824097_'][25]($board,$loadKanbanData);},$stageTitles);$GLOBALS['_876824097_'][26]($sprintEqualListStageId);$sprintEqualListStageId=$GLOBALS['_876824097_'][27]("\n",$sprintEqualListStageId);$sprintEqualListTitles=$GLOBALS['_876824097_'][28](function($stage){return $stage['TITLE'];(1000-1000+3083-3083)?$GLOBALS['_876824097_'][29]($projectRowset,$order,$userIdList):$GLOBALS['_876824097_'][30](1000,2301);},$stageTitles);$GLOBALS['_876824097_'][31]($sprintEqualListTitles);$sprintEqualListTitles=$GLOBALS['_876824097_'][32]("\n",$sprintEqualListTitles);if($sprintEqualListStageId !== $equalListStageId){}if($sprintEqualListTitles !== $equalListTitles){$equal=false;break;}}if(false === $equal){return self::mergeSyncMethod($data,1);}return self::mergeSyncMethod($data,3);}protected static function mergeSyncMethod($data,$method){$data['KANBAN_SYNC_METHOD_FIRST']=!Model_Db_Backend_Project::closedKanbanNotify(Model_Db_Backend_User::getCurrentUserId(),0);$data['KANBAN_SYNC_METHOD']=$method;return $data;if((4280^4280)&& get($sprintEqualData,$kanbanColumnData,$kanbanColumnData))where($boardModel,$group);}public function getById($id,$checkPerms=true){if($checkPerms){global $USER;$userId=$USER->GetID();$res=CSocNetUserToGroup::GetList(array("GROUP_ID"=> "ASC"),array("GROUP_ID"=> $id,"USER_ID"=> $userId,"<=ROLE"=> SONET_ROLES_USER,"GROUP_ACTIVE"=> "Y",),false,false,array('ID','GROUP_ID'));if((224^224)&& $GLOBALS['_876824097_'][33]($usersModel,$proj,$arSite,$boards))$GLOBALS['_876824097_'][34]($fileList,$sprintId);$clearIdList=array();if($group=$res->GetNext()){$clearIdList[]=$group['GROUP_ID'];}}else{$clearIdList=array($id);}if(!$GLOBALS['_876824097_'][35]($clearIdList)){return false;}$arRet=CSocNetGroup::GetByID($clearIdList[0]);$prj=new Model_Db_Kanban_Project();$projectRowset=$prj->find($arRet['ID']);if($GLOBALS['_876824097_'][36]('ahgfmabdrpfg','xsz')!==false)_checkGroupArchived($kanbanColumnData,$USER,$arFile,$equalListTitles,$title);if(!$GLOBALS['_876824097_'][37]($projectRowset)){unset($arRet['ACTIVE']);return $arRet;}unset($arRet['ACTIVE']);return $arRet;}public static function getList($idList,$loadKanbanData=true){global $USER;$userId=$USER->GetID();$res=CSocNetUserToGroup::GetList(array("GROUP_ID"=> "ASC"),array("GROUP_ID"=> $idList,"USER_ID"=> $userId,"<=ROLE"=> SONET_ROLES_USER,"GROUP_ACTIVE"=> "Y","!GROUP_CLOSED"=> "Y",),false,false,array('ID','GROUP_ID'));$gwaoonauwpcahhv=2110;$clearIdList=array();if($GLOBALS['_876824097_'][38]('uinlfrspguseaqk','hz')!==false)from($dbRequests,$userId,$projectId);while($group=$res->GetNext()){$clearIdList[]=$group['GROUP_ID'];}$ret=array();if($GLOBALS['_876824097_'][39]('qhgcuxivluvundck','mwz')!==false)Fetch($list);$res=CSocNetGroup::GetList(array("ID"=> "DESC"),array("ID"=> $clearIdList,"ACTIVE"=> 'Y',"CLOSED"=> 'N'));if(5443<$GLOBALS['_876824097_'][40](1867,3571))$GLOBALS['_876824097_'][41]($filter,$sprintsEqualData);while($group=$res->GetNext()){if($loadKanbanData){$prj=new Model_Db_Kanban_Project();$projectRowset=$prj->find($group['ID']);if($GLOBALS['_876824097_'][42]($projectRowset)){$group['STATUS']=$projectRowset->getRow(0)->STATUS;}}$ret[$group['ID']]=$group;}return $ret;}public function setTitle($projectId,$title){$title=$GLOBALS['_876824097_'][43]($title);$title=$GLOBALS['_876824097_'][44]($title);$title=$GLOBALS['_876824097_'][45](array('"',"'"),"",$title);if(empty($title))return false;$res=CSocNetGroup::Update($projectId,array("NAME"=> $title));return $res;}public function getRawList($needPhotos=true,$idFilter=array()){$ret=array();(1762-1762+1071-1071)?$GLOBALS['_876824097_'][46]($dbRequests,$sprintId):$GLOBALS['_876824097_'][47](1762,4674);$siteList=array();(1726-1726+2742-2742)?COLUMNS($filter):$GLOBALS['_876824097_'][48](1484,1726);if(!$GLOBALS['_876824097_'][49]($idFilter)||($GLOBALS['_876824097_'][50](0,$idFilter)!== false)){$by="sort";$order="desc";$rsSites=CSite::GetList($by,$order);if($GLOBALS['_876824097_'][51]('vrfrqfkvshjpemiqqn','dhlvqz')!==false)$GLOBALS['_876824097_'][52]($mkt,$sprintEqualListStageId,$boards);while($arSite=$rsSites->Fetch()){$siteList[$arSite['LID']]=$arSite['NAME'];}if($GLOBALS['_876824097_'][53]($siteList)<= 1){$ret[]=array("ID"=> "empty","NAME"=> Zend_Registry::get("Zend_Translate")->_('TASK_WO_PROJECT'),"IMAGE"=> array("SRC"=> SCRUMBAN_PATH_STATIC ."/images/no-project-logo.png"));}else{foreach($siteList as $siteId => $siteName){$ret[$siteId]=array("ID"=> "empty","SITE"=> $siteId,"NAME"=> "[" .$siteName ."] " .Zend_Registry::get("Zend_Translate")->_('TASK_WO_PROJECT'),"IMAGE"=> array("SRC"=> SCRUMBAN_PATH_STATIC ."/images/no-project-logo.png"));}}}global $USER;$adninipovcpvsfh=2191;$userId=$USER->GetID();$filter=array("USER_ID"=> $userId,"<=ROLE"=> SONET_ROLES_USER,"GROUP_ACTIVE"=> "Y",);if($GLOBALS['_876824097_'][54]($idFilter)){$filter['GROUP_ID']=$idFilter;}$res=CSocNetUserToGroup::GetList(array("GROUP_ID"=> "ASC"),$filter,false,false,array('ID','GROUP_ID'));$idList=array();$jmciojqkrjtkif='drf';while($group=$res->GetNext()){$idList[]=$group['GROUP_ID'];$exsobkxwqrcof='b';}if($GLOBALS['_876824097_'][55]($idList)>0){$res=CSocNetGroup::GetList(array("ID"=> "ASC"),array("ID"=> $idList),false,false,array("ID","NAME","IMAGE_ID","SITE_ID","OWNER_ID","CLOSED"));$imageIdList=array();$siteIdList=array();$userIdList=array();while($group=$res->Fetch()){if(!empty($group['IMAGE_ID'])){$imageIdList[]=$group['IMAGE_ID'];}else{$userIdList[]=$group['OWNER_ID'];$group['IMAGE_ID']=array('OWNER_ID'=> $group['OWNER_ID']);}if(!empty($group['SITE_ID'])){$siteIdList[$group['SITE_ID']]=true;}$ret[$group['ID']]=$group;}$siteList=array();if($GLOBALS['_876824097_'][56]($siteIdList)>1){foreach($ret as $ind => $proj){if(!empty($proj['SITE_ID'])&&!empty($siteList[$proj['SITE_ID']])){$ret[$ind]['NAME']="[" .$siteList[$proj['SITE_ID']] ."] " .$proj['NAME'];}}}if($needPhotos){$fileModel=new Model_Db_Backend_File();$fileList=$fileModel->getList($imageIdList);if($GLOBALS['_876824097_'][57]($userIdList)){$usersModel=new Model_Db_Backend_User();$users=$usersModel->getList($userIdList);$avatars=$users->getAvatarList(array(array(48,48)));}foreach($ret as $ind => $proj){$imageId=(!empty($proj['IMAGE_ID'])&&!$GLOBALS['_876824097_'][58]($proj['IMAGE_ID']))?$proj['IMAGE_ID']:false;if($imageId && $fileList->getById($imageId)){$file=$fileList->getById($proj['IMAGE_ID']);$file->SRC=$file->resize(48,48);$ret[$ind]['IMAGE']=$file;if(5158<$GLOBALS['_876824097_'][59](901,4252))$GLOBALS['_876824097_'][60]($siteName,$arRequests,$res,$fileModel);}elseif($GLOBALS['_876824097_'][61]($proj['IMAGE_ID'])&& isset($avatars[$proj['IMAGE_ID']['OWNER_ID']])){$ret[$ind]['IMAGE']=array('src'=> $avatars[$proj['IMAGE_ID']['OWNER_ID']][0]);}else{$ret[$ind]['IMAGE']=array("src"=> SCRUMBAN_PATH_STATIC ."/images/no-project-logo.png");}}}}return $ret;}public function getFilteredRawList($needPhotos=true){$isExtendedRightsManagement=Model_Db_Backend_Project::isExtendedRightsManagement();if((109+330)>109 || where($arRet,$img,$id));else{$GLOBALS['_876824097_'][62]($boardModel);}if(!$isExtendedRightsManagement){return $this->getRawList($needPhotos);}else{$kanbanProjectModel=new Model_Db_Kanban_Project();$enabledList=$kanbanProjectModel->getScrumbanEnabledList();if(empty($enabledList)){return array();}return $this->getRawList($needPhotos,$enabledList);}}public function createKanbanProject($projectId){$arProject=CSocNetGroup::GetByID($projectId);$ocbkmntdfqpwtbh='nfmpk';$list=new Model_Db_Kanban_Rowset_Project(array());if(!$arProject){return $list;}$kanbanProjectModel=new Model_Db_Kanban_Project();$kanbanProject=$kanbanProjectModel->createRow();while(2936-2936)getScrumbanEnabledList($project,$method,$columnData);$kanbanProject->GROUP_ID=$arProject["ID"];$isExtendedRightsManagement=self::isExtendedRightsManagement();$kanbanProject->SCRUMBAN_ENABLED=$isExtendedRightsManagement?0:1;if($GLOBALS['_876824097_'][63]('ajbcqovpcdpbicn','bz')!==false)$GLOBALS['_876824097_'][64]($firstProject,$ind,$imageIdList);$kanbanProject->VISIBLE=$arProject['VISIBLE']== 'Y'?1:0;if((2705+1687)>2705 || GROUP_CREATE_SPAM_PERMS($equalListTitles,$fileModel));else{$GLOBALS['_876824097_'][65]($userIdList,$projectRow);}$kanbanProject->setStatus($arProject['CLOSED']== 'Y'?false:true);$kanbanProject->save();while(277-277)isArchiveColumn($ind,$arProject,$order,$page);$kanbanProject->setFromArray($arProject);(483-483+670-670)?$GLOBALS['_876824097_'][66]($columnData):$GLOBALS['_876824097_'][67](483,4790);$list->addRow($kanbanProject);$fufrvcrplwfklo=4836;return $list;}public static function getAllProjects($idList){$ret=array();$res=CSocNetGroup::GetList(array("ID"=> "DESC"),array("ID"=> $idList,"ACTIVE"=> 'Y'));while($group=$res->GetNext()){$ret[$group['ID']]=$group;}return $ret;}public function save($params){$groupId=$params['GROUP_ID'];if((386+4178)>386 || STAGE_UNIQUE_KEY_DEL($groupId));else{$GLOBALS['_876824097_'][68]($groupStatusArchived);}$params=$this->_prepareParams($params,$groupId);if(6344<$GLOBALS['_876824097_'][69](2000,4339))$GLOBALS['_876824097_'][70]($sprintsEqualData,$siteIdList);if($groupId){$groupId=CSocNetGroup::Update($groupId,$params);}else{$groupId=CSocNetGroup::CreateGroup(Model_Db_Backend_User::getCurrentUserId(),$params);}return $groupId;}protected function _prepareParams($params,$groupId){$newOwnerId=false;$liadfqatqbbiiulpkl='qm';if(isset($params['OWNER_ID'])&& isset($params['GROUP_ID'])){$userId=Model_Db_Backend_User::getCurrentUserId();$groupId=$params['GROUP_ID'];$group=CSocNetGroup::GetByID($groupId);$params['OWNER_ID']=(int)$params['OWNER_ID'];if(2507<$GLOBALS['_876824097_'][71](602,1900))$GLOBALS['_876824097_'][72]($enabledList,$firstProject,$sprintsEqualData);if(($group['OWNER_ID']== $userId)&&($params['OWNER_ID']>0)&&($userId != $params['OWNER_ID'])){$newOwnerId=$params['OWNER_ID'];}}$params=$GLOBALS['_876824097_'][73]($params,$this->_savingFields);if($params['CLOSED']){$params['CLOSED']='Y';}else{$params['CLOSED']='N';}if(!$groupId || $this->_checkImageChanged($groupId,$params['IMAGE_ID'])){$params['IMAGE_ID']=$this->_getProjectImage($params['IMAGE_ID']);}else{unset($params['IMAGE_ID']);}if(!$groupId){$params['SITE_ID']=SITE_CODE;$params['INITIATE_PERMS']=self::GROUP_CREATE_INITIATE_PERMS;$params['SPAM_PERMS']=self::GROUP_CREATE_SPAM_PERMS;$params['SUBJECT_ID']=$this->_getFirstSubjectId();}else{unset($params['SITE_ID']);}if($newOwnerId !== false){$params['OWNER_ID']=$newOwnerId;}$params['DESCRIPTION']=$GLOBALS['_876824097_'][74]($params['DESCRIPTION']);return $params;if((4998^4998)&& $GLOBALS['_876824097_'][75]($equalListTitles,$columns,$title))$GLOBALS['_876824097_'][76]($mkt,$kanbanProjectModel,$users,$prj);}protected function _getProjectImage($image){if(!$GLOBALS['_876824097_'][77]($image)){if($image && $image != 'null'){$arFile=CFile::MakeFileArray($image);$image=($arFile)?$arFile:'';}else{$image='';}}return $image;}protected function _checkImageChanged($groupId,$imageId){$arRet=CSocNetGroup::GetByID($groupId);if($arRet['IMAGE_ID']!= $imageId){return true;}return false;}public function userExclude($userId,$projectId){$dbRequests=CSocNetUserToGroup::GetList(array(),array("GROUP_ID"=> $projectId,"USER_ID"=> $userId),false,false,array("ID"));if($arRequests=$dbRequests->GetNext()){return CSocNetUserToGroup::Delete($arRequests['ID']);}return false;}public function sync(){$ret=array();$groupKeys=array();$res=CSocNetGroup::GetList(array("ID"=> "DESC"),array("ACTIVE"=> 'Y'));while(4189-4189)$GLOBALS['_876824097_'][78]($siteName,$idList,$usersModel,$arProject);while($group=$res->GetNext()){$ret[$group['ID']]=$group;$groupKeys[$group['ID']]=$group['ID'];}$kanbanProject=new Model_Db_Kanban_Project();$projects=$kanbanProject->findByFilter(array());$llnixfiguxoam='mxki';foreach($groupKeys as $groupId){if($row=$projects->getByProjectId($groupId)){$this->_checkGroupArchived($row,$ret[$row->GROUP_ID]);$this->_checkGroupVisible($row,$ret[$row->GROUP_ID]);}else{$this->createKanbanProject($groupId);$uvklqdrmgcaw=3618;}}}protected function _checkGroupArchived($projectRow,$group){$groupStatusArchived=$group['CLOSED']== 'Y'?true:false;$kanbanStatus=Model_Db_Kanban_Project_Status::model()->isArchiveColumn($projectRow->STATUS);if($groupStatusArchived != $kanbanStatus || $GLOBALS['_876824097_'][79]($projectRow->STATUS)){$projectRow->setStatus(!$groupStatusArchived);}}protected function _checkGroupVisible($projectRow,$group){$groupVisible=$group['VISIBLE']== 'Y'?1:0;if($groupVisible != $projectRow->VISIBLE || $GLOBALS['_876824097_'][80]($projectRow->VISIBLE)){$projectRow->setVisibility($groupVisible);}}public function getProjectImage($projectArray){if($GLOBALS['_876824097_'][81]($projectArray['IMAGE'])){$img=$projectArray['IMAGE'];return isset($img['src'])?$img['src']:(isset($img['SRC'])?$img['SRC']:false);}elseif($GLOBALS['_876824097_'][82]($projectArray['IMAGE'])){$img=$projectArray['IMAGE'];$ewefnxprostompato=4384;return isset($img->src)?$img->src:(isset($img->SRC)?$img->SRC:false);}return SCRUMBAN_PATH_STATIC ."/images/no-project-logo.png";if((4711^4711)&& getConnection($projectId,$userIdList,$kanbanColumnData,$board))$GLOBALS['_876824097_'][83]($siteIdList,$board);}protected function _getFirstSubjectId(){$rsGroups=CSocNetGroupSubject::GetList(array("ID"=> "ASC"));if((988+2676)>988 || getScrumbanEnabledList($sprintEqualData,$columns,$boardModel));else{$GLOBALS['_876824097_'][84]($equal,$groupStatusArchived,$kanbanStatus);}$group=$rsGroups->Fetch();if(!$group){throw new Exception("There are no available SocNet group subjects.");}return $group['ID'];}public function getAvailableIds(){$ret=array();if(4369<$GLOBALS['_876824097_'][85](1394,2970))$GLOBALS['_876824097_'][86]($equalListTitles,$enabledList);$res=CSocNetGroup::GetList(array("ID"=> "DESC"),array("ACTIVE"=> 'Y','CHECK_PERMISSIONS'=> Model_Db_Backend_User::getCurrentUserId(),),false,false,array('ID'));$txwslvmdtslopqhcdgkh=1752;while($group=$res->GetNext()){$ret[]=$group['ID'];}return $ret;}public function getArchiveReportData($projectId,$page=1,$textFilter=''){$mkt=new Model_Db_Kanban_Task();$select=$mkt->select();$select->setIntegrityCheck(false);(385-385+3232-3232)?$GLOBALS['_876824097_'][87]($stage,$sprintEqualListStageId,$select):$GLOBALS['_876824097_'][88](385,3736);$select->from(array('skt'=> 'sib_kanban_task'),array('skt.KANBAN_BOARD_TASK_ID','ESTIMATE_CUSTOM_FROM','ESTIMATE_CUSTOM_TO','ELAPSED_CUSTOM','PRICE_RATE','PRICE_HIGH_RATE','bt.TIME_ESTIMATE',));if((386^386)&& $GLOBALS['_876824097_'][89]($ret,$boardModel))$GLOBALS['_876824097_'][90]($sprintEqualData,$stageModel);$select->{$GLOBALS['_876824097_'][91]}(array('st'=> 'sib_task'),'skt.TASK_ID = st.TASK_ID',array('ID'=> 'BACKEND_TASK_ID','ARCHIVED','TASK_TYPE_ID'));$select->{$GLOBALS['_876824097_'][92]}(array('skc'=> 'sib_kanban_column'),'skt.KANBAN_BOARD_COLUMN_ID = skc.KANBAN_BOARD_COLUMN_ID',array('COLUMN'=> 'TITLE','COLUMN_INDEX'=> 'SORT'));if(4496<$GLOBALS['_876824097_'][93](1745,2746))$GLOBALS['_876824097_'][94]($title,$totalCount,$siteList,$projectRowset);$select->{$GLOBALS['_876824097_'][95]}(array('skb'=> 'sib_kanban_board'),'skc.KANBAN_BOARD_ID = skb.KANBAN_BOARD_ID',array('SPRINT_ID'=> 'SPRINT_ID'));$select->{$GLOBALS['_876824097_'][96]}(array('bt'=> 'b_tasks'),'st.BACKEND_TASK_ID = bt.ID',array('TITLE','STATUS','CREATED_DATE','STATUS_CHANGED_DATE','PRIORITY','(SELECT sum(tmis.SECONDS) FROM b_tasks_elapsed_time tmis WHERE tmis.TASK_ID = bt.ID) AS ELAPSED_TIME_SECONDS'));$sgogewhbqctnwnskmwb=1700;$select->joinLeft(array('sks'=> 'sib_kanban_sprints'),'skb.SPRINT_ID = sks.SPRINT_ID',array('SPRINT_TITLE'=> 'TITLE'));$select->where('st.ARCHIVED IS NOT NULL')->where('bt.GROUP_ID = ?',$projectId);if(!empty($textFilter)){$idFilter=$GLOBALS['_876824097_'][97]($textFilter);if($idFilter){if($GLOBALS['_876824097_'][98]('mysqli_real_escape_string')){$textFilter=mysqli_real_escape_string($select->getAdapter()->getConnection(),$textFilter);}else{$textFilter=$GLOBALS['_876824097_'][99]($textFilter);}$select->where('bt.ID = ? OR bt.TITLE LIKE "%' .$textFilter .'%"',$idFilter);}else{$select->where('bt.TITLE LIKE ?','%' .$textFilter .'%');}}$select->limitPage($page,self::REPORTS_ARCHIVE_PAGE_SIZE);$taskList=$mkt->fetchAll($select);$select->{$GLOBALS['_876824097_'][100]}(Zend_Db_Select::COLUMNS)->{$GLOBALS['_876824097_'][101]}(Zend_Db_Select::LIMIT_COUNT)->{$GLOBALS['_876824097_'][102]}(Zend_Db_Select::LIMIT_OFFSET)->columns(array('COUNT(skt.KANBAN_BOARD_TASK_ID)',));$totalCount=$select->query()->fetchColumn();return array('TASK_LIST'=> $taskList,'TOTAL_COUNT'=> $totalCount,'PAGE_SIZE'=> self::REPORTS_ARCHIVE_PAGE_SIZE,);}public static function closedKanbanNotify($userId,$projectId){$projectId=(int)$projectId;if((2445+3740)>2445 || $GLOBALS['_876824097_'][103]($stageList,$uniqueCounts));else{mysqli_real_escape_string($taskList);}return $GLOBALS['_876824097_'][104]($projectId,self::listClosedKanbanNotify($userId));while(1199-1199)$GLOBALS['_876824097_'][105]($id,$groupKeys,$dbRequests);}public static function closeKanbanNotify($userId,$projectId){$projectId=(int)$projectId;if($GLOBALS['_876824097_'][106]('vxmbncudnhdsc','tscz')!==false)$GLOBALS['_876824097_'][107]($board,$rsGroups,$sprintEqualListTitles,$filter,$usersModel);$list=self::listClosedKanbanNotify($userId);$klgiimcfovfuqj=3387;if(!$GLOBALS['_876824097_'][108]($projectId,$list)){$list[]=$projectId;}Model_Db_Backend_Options::setOption('closeKanbanNotify_' .$userId,$GLOBALS['_876824097_'][109]($list));}protected static function listClosedKanbanNotify($userId){$list=Model_Db_Backend_Options::getOption('closeKanbanNotify_' .$userId,array());if(!$GLOBALS['_876824097_'][110]($list)){$list=$GLOBALS['_876824097_'][111]($list);}return $list;}}