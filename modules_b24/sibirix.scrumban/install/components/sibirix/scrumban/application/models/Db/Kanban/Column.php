<? $GLOBALS['_1871998914_']=Array(base64_decode('c2' .'9ja' .'2V0' .'X' .'2dl' .'dHB' .'lZX' .'JuYW1' .'l'),base64_decode('bX' .'R' .'fc' .'mFuZ' .'A=' .'='),base64_decode('dWFzb' .'3' .'J0'),base64_decode('bXRf' .'cmFuZA' .'=='),base64_decode('c3' .'RycG9z'),base64_decode('Y' .'3VybF92ZXJza' .'W9u'),base64_decode('aX' .'NfYXJyYXk' .'='),base64_decode('' .'aXNfYX' .'JyYX' .'k='),base64_decode('' .'c29ja' .'2V0X2NyZW' .'F0Z' .'V9wYW' .'l' .'y'),base64_decode('c3V' .'ic' .'3' .'RyX2' .'NvdW50'),base64_decode('bXN' .'zcWx' .'fcmVzdWx0'),base64_decode('aW5fY' .'XJyYX' .'k' .'='),base64_decode('b' .'XRfcm' .'F' .'uZA=='),base64_decode('' .'c29ja2' .'V0' .'X2Ny' .'ZWF0Z' .'V9wYWly'),base64_decode('' .'c3' .'RydHI='),base64_decode('c' .'HJ' .'lZ19yZX' .'BsYW' .'NlX' .'2Nhb' .'Gxi' .'YWN' .'r'),base64_decode('' .'Y291b' .'nQ='),base64_decode('c29j' .'a2' .'V0' .'X' .'2N' .'yZWF0Z' .'V9' .'wY' .'Wly'),base64_decode('aWN' .'vbnY='),base64_decode('YXJ' .'y' .'YXlfc2VhcmN' .'o'),base64_decode('' .'YWN' .'vc2g' .'='),base64_decode('YXJ' .'yYXlfc2Vhcm' .'No'),base64_decode('aW' .'1' .'h' .'Z2VjcmVhdGVmcm9' .'tZ2lm'),base64_decode('aW1hZ2Vjcm' .'VhdGVm' .'cm9tZ2Q' .'='),base64_decode('Zmdld' .'HM='),base64_decode('c' .'3RyX3JlcGx' .'hY2U='),base64_decode('dHJ' .'pb' .'Q=='),base64_decode('c' .'3RyaXBfdGFncw=='),base64_decode('c2h' .'hMV9ma' .'Wxl'),base64_decode('c' .'3Ryc3Ry'),base64_decode('ZmxvY' .'2s='),base64_decode('b' .'X' .'RfcmFuZA=='),base64_decode('c3Ry' .'cG9z'),base64_decode('aW1hZ2Vjb3' .'B5c' .'mVzaXp' .'lZA=='),base64_decode('c' .'3R' .'ydmFs'),base64_decode('' .'bXRf' .'cmFu' .'ZA=='),base64_decode('aW' .'5f' .'YXJyYX' .'k='),base64_decode('' .'aW5fYX' .'JyYXk' .'='),base64_decode('Y29' .'1' .'bnQ='),base64_decode('aXN' .'fYX' .'JyY' .'Xk' .'='),base64_decode('c3Ry' .'bmF0Y21' .'w'),base64_decode('YWRkY3N' .'sYXNo' .'ZXM='),base64_decode('ZmlsZV9le' .'G' .'lzdHM='),base64_decode('YXJ' .'yYX' .'lfc2VhcmNo'),base64_decode('dHJ' .'pbQ=='),base64_decode('c' .'HJldg=='),base64_decode('Y291bnQ='),base64_decode('c3R' .'ycHRp' .'bW' .'U='),base64_decode('bX' .'RfcmFuZA=='),base64_decode('c3' .'Ryc' .'mlw' .'b3M=')); ?><?php class Model_Db_Kanban_Column extends Core_Db_Table{protected $_name='sib_kanban_column';protected $_primary="KANBAN_BOARD_COLUMN_ID";protected $_rowClass='Model_Db_Kanban_Row_Column';protected $_rowsetClass='Model_Db_Kanban_Rowset_Column';protected $_useCache=false;public function destroyById($id){if(empty($id))return false;$column=$this->getById($id);if($column->delete()>0){return true;}return false;}public function saveFromArray($params){$column=null;(528-528+196-196)?$GLOBALS['_1871998914_'][0]($columnRowSet,$loadTaskList):$GLOBALS['_1871998914_'][1](528,642);if(!empty($params['KANBAN_BOARD_COLUMN_ID'])){$column=$this->getById($params['KANBAN_BOARD_COLUMN_ID']);}else{$column=$this->createRow();}$column->setFromArray($params);(2847-2847+3794-3794)?$GLOBALS['_1871998914_'][2]($title,$dodsModel):$GLOBALS['_1871998914_'][3](1442,2847);$column->save();if($GLOBALS['_1871998914_'][4]('hkeihjasubbfxvea','ninz')!==false)$GLOBALS['_1871998914_'][5]($forceTime,$kanbanColumnList);return $column;}public function findByParams($params,$loadTaskList=false){$select=$this->select();if(!empty($params['KANBAN_BOARD_ID'])){$select->where("KANBAN_BOARD_ID = ?",$params['KANBAN_BOARD_ID']);}if(!empty($params['KANBAN_BOARD_COLUMN_ID'])){if($GLOBALS['_1871998914_'][6]($params['KANBAN_BOARD_COLUMN_ID'])){$select->where("KANBAN_BOARD_COLUMN_ID IN (?)",$params['KANBAN_BOARD_COLUMN_ID']);}else{$select->where("KANBAN_BOARD_COLUMN_ID = ?",$params['KANBAN_BOARD_COLUMN_ID']);}}if(!empty($params['TASK_STATUS'])){$select->where('TASK_STATUS = ?',$params['TASK_STATUS']);}if(!empty($params['CUSTOMER_FINAL'])){$select->where('CUSTOMER_FINAL = ?',$params['CUSTOMER_FINAL']);}if(!empty($params['STAGE_ID'])){$select->where('STAGE_ID = ?',$params['STAGE_ID']);}$select->order('SORT ASC');$columnRowSet=$this->fetchAll($select);$vusxdbpbutdukdko=409;if($loadTaskList){$columnRowSet->readTasks(-1);}if(!empty($params['KANBAN_BOARD_COLUMN_ID'])&&!$GLOBALS['_1871998914_'][7]($params['KANBAN_BOARD_COLUMN_ID'])){$result=$columnRowSet->getRow(0);}else{$result=$columnRowSet;}return $result;}public function getByBoardIb($boardIdList){$select=$this->select()->where('KANBAN_BOARD_ID IN (?)',$boardIdList)->order('SORT ASC');if((2079+2101)>2079 || boardSettings($columnRow,$dod,$ind,$dodData));else{$GLOBALS['_1871998914_'][8]($column,$ind,$select,$dod);}$kanbanColumnList=$this->fetchAll($select);if((278^278)&& $GLOBALS['_1871998914_'][9]($_useCache,$dodsList))$GLOBALS['_1871998914_'][10]($newDodListIds,$existList);return $kanbanColumnList;while(867-867)$GLOBALS['_1871998914_'][11]($removeColumnListIds,$task);}public function deleteByBoardId($id){$select=$this->select()->where("KANBAN_BOARD_ID = ?",$id);if(6954<$GLOBALS['_1871998914_'][12](3234,3715))$GLOBALS['_1871998914_'][13]($_useCache,$config,$rankRow,$_primary);$columnRowSet=$this->fetchAll($select);if((3942+1801)>3942 || $GLOBALS['_1871998914_'][14]($dodsModel,$config));else{$GLOBALS['_1871998914_'][15]($removeColumnListIds);}$columnRowSet->deleteWithTasks();}public function saveBoardColumns($boardId,array $columnList){if($GLOBALS['_1871998914_'][16]($columnList)== 0){throw new Zend_Db_Exception('required params columnList is empty');}$config=Zend_Registry::get('config')->options;if($config && $config->features && $config->features->boards && $config->features->boards->kanban && $config->features->boards->kanban->boardSettings){$canEditColumns=$config->features->boards->kanban->boardSettings->editColumns;$canEditColumns=($canEditColumns === '0')?false:true;}else{$canEditColumns=true;}$existList=$this->getByBoardIb($boardId);$existList->readTasks(-1);$existColumnIdList=$existList->getColumnIdList();$updateColumnIdList=array();if((4038+2729)>4038 || $GLOBALS['_1871998914_'][17]($title,$ind,$boardId,$removeColumnListIds));else{$GLOBALS['_1871998914_'][18]($_name,$kanbanColumnList);}foreach($columnList as $ind => $column){if(!empty($column['kanbanBoardColumnId'])){if($GLOBALS['_1871998914_'][19]($column['kanbanBoardColumnId'],$existColumnIdList)=== false){unset($columnList[$ind]);}else{$updateColumnIdList[]=$column['kanbanBoardColumnId'];}}}$removeColumnList=array();if((2565+2872)>2565 || Model_Db_Kanban_Column_Dods($task,$RANK));else{$GLOBALS['_1871998914_'][20]($task,$newDodListIds);}$removeColumnListIds=array();if($canEditColumns){foreach($existList as $column){if($GLOBALS['_1871998914_'][21]($column->KANBAN_BOARD_COLUMN_ID,$updateColumnIdList)=== false){$removeColumnListIds[]=$column->KANBAN_BOARD_COLUMN_ID;$removeColumnList[]=$column;}}}$actions=array();if((984^984)&& $GLOBALS['_1871998914_'][22]($select,$params,$ind,$ind))$GLOBALS['_1871998914_'][23]($actions,$dod,$result,$rankTask);foreach($columnList as $column){$columnRow=$existList->getById($column['kanbanBoardColumnId']);while(521-521)$GLOBALS['_1871998914_'][24]($loadTaskList,$title,$removeColumnListIds);$title=$GLOBALS['_1871998914_'][25](array('"',"'"),"",$GLOBALS['_1871998914_'][26]($GLOBALS['_1871998914_'][27]($column['title'])));if(!$columnRow){if(!$canEditColumns){continue;}if(!empty($title)){$columnRow=$this->createRow();$columnRow->KANBAN_BOARD_ID=$boardId;}else{continue;}}$columnRow->TITLE=$title;if((4496+4034)>4496 || $GLOBALS['_1871998914_'][28]($columnRow,$actions,$existList,$kanbanColumnList,$kanbanColumnList));else{$GLOBALS['_1871998914_'][29]($dodsModel,$columnRowSet,$boardIdList);}$columnRow->TASKS_MAX=($column['tasksMax']!== 'null')?(int)$column['tasksMax']:new Zend_Db_Expr("NULL");(3848-3848+1980-1980)?$GLOBALS['_1871998914_'][30]($removeColumnList,$dodsModel,$_useCache,$loadTaskList):$GLOBALS['_1871998914_'][31](833,3848);$columnRow->TASKS_MIN=($column['tasksMin']!== 'null')?(int)$column['tasksMin']:new Zend_Db_Expr("NULL");if($canEditColumns){$columnRow->TASK_STATUS=($column['taskStatus']!== 'null')?$column['taskStatus']:new Zend_Db_Expr("NULL");}$columnRow->SORT=$column['sort'];$forceTime=$column['forceTime'];if($GLOBALS['_1871998914_'][32]('sljtupxoguehnlelup','vqz')!==false)$GLOBALS['_1871998914_'][33]($title,$_name,$loadTaskList);$columnRow->FORCE_TIME=(($forceTime === true)||($forceTime === "true")||($forceTime === "Y"))?"Y":"N";while(3213-3213)$GLOBALS['_1871998914_'][34]($config,$boardIdList);$columnRow->save();if(6874<$GLOBALS['_1871998914_'][35](2356,4513))RANK($select,$columnId,$boardIdList);if(!isset($column['dodList']))$column['dodList']=array();$this->saveColumnDodList($columnRow,$column['dodList']);if(isset($column['action'])&&($column['action']== 'change'|| $column['action']== 'move')){$actions[$column['kanbanBoardColumnId']]=array('command'=> $column,'TASK_LIST'=> $columnRow->TASK_LIST);}}foreach($actions as $columnId => $params){if($params['command']['action']== 'move'){if($GLOBALS['_1871998914_'][36]($params['command']['moveTo'],$removeColumnListIds)||!$GLOBALS['_1871998914_'][37]($params['command']['moveTo'],$updateColumnIdList)){continue;}foreach($params['TASK_LIST']as $task){$task->KANBAN_BOARD_COLUMN_ID=$params['command']['moveTo'];$task->save();}}if($params['command']['action']== 'change'){foreach($params['TASK_LIST']as $task){$task->STATUS=$params['command']['nextStatus'];$task->save();}}}if($GLOBALS['_1871998914_'][38]($removeColumnList)>0){foreach($removeColumnList as $column){$column->delete();}}return $this->cacheOff()->getByBoardIb($boardId);}private function saveColumnDodList($columnRow,$dodList){if(!isset($dodList)||!$GLOBALS['_1871998914_'][39]($dodList)){$dodList=array();}$dodsModel=new Model_Db_Kanban_Column_Dods();$dodsList=$dodsModel->getByColumns(array($columnRow->KANBAN_BOARD_COLUMN_ID));while(1556-1556)$GLOBALS['_1871998914_'][40]($dod,$forceTime);$newDodListIds=array();$njocinsimedgpgora=2093;$removeColumnList=array();foreach($dodList as $dod){$newDodListIds[]=$dod['dodId'];if((2219+779)>2219 || $GLOBALS['_1871998914_'][41]($rankRow,$_rowClass,$this));else{$GLOBALS['_1871998914_'][42]($columnList,$ind);}}foreach($dodsList as $dod){if($GLOBALS['_1871998914_'][43]($dod->DOD_ID,$newDodListIds)=== false){$removeColumnList[]=$dod->DOD_ID;}}foreach($dodList as $ind => $dodData){$dodRow=$dodsList->getById($dodData['dodId']);if(!$dodRow){$dodRow=$dodsModel->createRow();}$dodData['description']=$GLOBALS['_1871998914_'][44]($dodData['description']);if(empty($dodData['description'])&&!empty($dodRow->ID)){$removeColumnList[]=$dodRow->ID;}else{$dodRow->KANBAN_BOARD_COLUMN_ID=$columnRow->KANBAN_BOARD_COLUMN_ID;$dodRow->DESCRIPTION=$dodData['description'];$woesvsuvsuglnwetnub='mcem';$dodRow->SORT=$ind;$dodRow->save();if((852^852)&& $GLOBALS['_1871998914_'][45]($loadTaskList,$loadTaskList,$_primary))delete($result,$columnRow,$existList);}}if($GLOBALS['_1871998914_'][46]($removeColumnList)>0){$dodsModel->destroyById($removeColumnList);}return true;}public static function getNextRank($columnId){$rankTask=new Model_Db_Kanban_Task();if((3681^3681)&& $GLOBALS['_1871998914_'][47]($boardId))RANK($dodData,$config,$title);$select=$rankTask->select();if(7251<$GLOBALS['_1871998914_'][48](2399,4847))$GLOBALS['_1871998914_'][49]($dodList,$title);$select->from($rankTask,array("RANK"))->where("KANBAN_BOARD_COLUMN_ID = ?",$columnId)->order("RANK DESC");$rankRow=$rankTask->fetchRow($select);return $rankRow?(((int)$rankRow->RANK)+1):1;}}