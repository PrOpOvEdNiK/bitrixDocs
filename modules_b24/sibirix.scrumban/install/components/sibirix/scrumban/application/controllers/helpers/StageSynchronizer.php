<? $GLOBALS['_659994175_']=Array(base64_decode('Y' .'WRk' .'Y3Ns' .'YXNoZX' .'M='),base64_decode('' .'Z' .'mls' .'ZV9n' .'Z' .'XRfY29udGVudHM='),base64_decode('bXRf' .'cmFuZA=='),base64_decode('YWR' .'kc' .'2xhc2hlcw=='),base64_decode('' .'cmV3aW' .'5k'),base64_decode('Y3VycmV' .'udA=='),base64_decode('Zm' .'Vv' .'Zg=='),base64_decode('b' .'XRf' .'cmFuZA' .'=='),base64_decode('c' .'3RycG9z'),base64_decode('Y' .'X' .'J' .'yYXlfbWVyZ2U' .'='),base64_decode('c29ja2V0' .'X2dldF9' .'vc' .'H' .'Rpb24='),base64_decode('c' .'2Vz' .'c2lvbl' .'9pc1' .'9y' .'ZWdpc' .'3Rlcm' .'Vk'),base64_decode('b' .'XR' .'f' .'cmF' .'uZA' .'=='),base64_decode('' .'c3Rydm' .'Fs'),base64_decode('' .'bWtka' .'XI' .'='),base64_decode('' .'bX' .'Rf' .'cm' .'FuZ' .'A=='),base64_decode('c3Ryc' .'G9z'),base64_decode('Y' .'3Jj' .'MzI' .'='),base64_decode('YWRkY' .'3NsYXNoZ' .'X' .'M='),base64_decode('cHJlZ19y' .'ZX' .'BsYWNlX2Nh' .'b' .'Gxi' .'YWNr'),base64_decode('Y3VycmVudA=' .'='),base64_decode('c29ja2V0X2' .'NyZWF0' .'ZQ=='),base64_decode('bXRf' .'cmFuZA=' .'='),base64_decode('c29j' .'a2V' .'0X2' .'dldF9vcHRpb' .'24='),base64_decode('' .'cHJ' .'lZ' .'1' .'9z' .'cGx' .'pdA=' .'='),base64_decode('bXRfc' .'mFuZA' .'=='),base64_decode('cmV3aW5k'),base64_decode('bXRfcmFuZ' .'A=='),base64_decode('' .'Y' .'3Vyc' .'mVu' .'dA=' .'='),base64_decode('b' .'mV' .'4dA' .'=='),base64_decode('YX' .'JyYXlf' .'c3BsaWNl'),base64_decode('' .'bXRfcmFuZA=='),base64_decode('' .'Y' .'mFzZTY' .'0X2' .'V' .'uY2' .'9k' .'ZQ' .'=='),base64_decode('bXRfcmF' .'uZA=='),base64_decode('bXR' .'fcmFu' .'Z' .'A=='),base64_decode('c3RydG9r'),base64_decode('Y291bnQ='),base64_decode('Z' .'mx1c2g' .'='),base64_decode('b' .'XRfcmF' .'uZ' .'A=='),base64_decode('Zm' .'dldG' .'M' .'='),base64_decode('bXR' .'fcm' .'FuZA=='),base64_decode('ZXhw' .'bG' .'9kZQ=='),base64_decode('c' .'3Ry' .'cG' .'9z'),base64_decode('dWFzb3J0'),base64_decode('cHJpbnR' .'fcg=='),base64_decode('c' .'GF' .'jaw=='),base64_decode('Y291bn' .'Q='),base64_decode('c3Ryc' .'G9z'),base64_decode('YXJ' .'yYXlfc3B' .'saWNl'),base64_decode('b' .'Wljcm90aW1l'),base64_decode('b' .'X' .'Rfcm' .'F' .'u' .'Z' .'A=' .'='),base64_decode('c2Vzc2' .'lvbl9nZ' .'XRfY2' .'9va2llX3' .'Bh' .'cmF' .'tcw' .'=='),base64_decode('bmV4dA=' .'='),base64_decode('bXR' .'fc' .'mFuZ' .'A' .'=='),base64_decode('c29ja2V0X2Nsb3N' .'l'),base64_decode('aW1hZ2V' .'j' .'cmVhdGVmcm9ta' .'nBlZw=='),base64_decode('bXRfcmFuZA=' .'='),base64_decode('YXJy' .'YXlfc' .'mV2Z' .'X' .'JzZQ=' .'='),base64_decode('' .'c3' .'RycG9' .'z'),base64_decode('YWNvcw=' .'='),base64_decode('b' .'X' .'R' .'fcmFuZA=='),base64_decode('c' .'3Ry' .'bmNhc2' .'VjbXA='),base64_decode('c' .'3Ry' .'cG9z'),base64_decode('c3' .'RycG9z'),base64_decode('c2V' .'z' .'c2l' .'vb' .'l' .'9' .'pZA=='),base64_decode('c' .'mV3aW5k'),base64_decode('aW' .'1hZ2' .'Vjb3B5c' .'mVz' .'YW1wbGVk'),base64_decode('' .'bXRfcm' .'Fu' .'ZA=='),base64_decode('' .'Y3VycmV' .'ud' .'A=='),base64_decode('ZmlsZ' .'V9' .'le' .'GlzdHM='),base64_decode('Y3VybF9tdW' .'x0aV9' .'p' .'bm' .'l' .'0'),base64_decode('Y' .'XJyYXlfbWVyZ2' .'U='),base64_decode('c3RycG' .'9z'),base64_decode('bXRfcmFuZA=='),base64_decode('c2' .'9j' .'a2V0X' .'2dldF9zdGF' .'0d' .'XM='),base64_decode('bWljcm90aW' .'1l'),base64_decode('c2' .'Vzc' .'2l' .'vbl9p' .'ZA=='),base64_decode('bXRfcm' .'FuZA=' .'='),base64_decode('' .'YXJyYXlfc2xpY2U='),base64_decode('YXJyYXlfcm' .'V2ZXJzZQ=='),base64_decode('' .'Y' .'X' .'JyYXlfc3BsaWNl'),base64_decode('c3RycG' .'9z'),base64_decode('' .'YX' .'Bh' .'Y2hl' .'X2dldF92' .'Z' .'XJzaW9u'),base64_decode('bXRfcmFuZA=='),base64_decode('bXRfc' .'mFuZA' .'=='),base64_decode('aW1hZ' .'2V' .'j' .'b3B5cmVz' .'YW1' .'wbGVk'),base64_decode('Y291bnQ='),base64_decode('b' .'XRfcmFuZA=='),base64_decode('aW1hZ2' .'Vjc' .'mVhdGVmcm9tanBlZw=' .'='),base64_decode('Y2' .'91b' .'nQ='),base64_decode('YXJy' .'YXlfa2V5cw' .'=='),base64_decode('YXJy' .'YXl' .'fZmxpcA=='),base64_decode('YXJyYXlf' .'Zm' .'xpcA' .'=' .'='),base64_decode('YXJy' .'YX' .'lf' .'a' .'2V5cw' .'=='),base64_decode('aW1hZ' .'2Vj' .'b3B5c' .'mVzaX' .'p' .'lZ' .'A=='),base64_decode('YXJyYXl' .'fa' .'2V5cw' .'=='),base64_decode('Yml' .'uMmh' .'l' .'eA=' .'='),base64_decode('c' .'29ja' .'2V0' .'X2Nvbm5' .'lY3Q' .'='),base64_decode('c3RycG9z'),base64_decode('b' .'Xlzc' .'W' .'xfY2xvc2U=')); ?><?php use Bitrix\Tasks\Dispatcher\PublicAction\Task\Stages;class Sibirix_Controller_Action_Helper_StageSynchronizer extends Zend_Controller_Action_Helper_Abstract{protected $_project;protected $_stageList;protected $_boardList;protected $_type=false;protected $_stageModel;function direct(){return $this;if((4412+569)>4412 || _type($ktm,$result));else{$GLOBALS['_659994175_'][0]($toDelete);}}public function __construct(){$this->_stageModel=new Model_Db_Backend_Task_Stage();}public function setProject(Model_Db_Kanban_Row_Project $project){$this->_project=$project;}public function setType($type){$this->_type=$type;(1682-1682+1174-1174)?$GLOBALS['_659994175_'][1]($taskList,$stageTitles):$GLOBALS['_659994175_'][2](212,1682);}protected function _normalizeProjectColumns(){$columnModel=new Model_Db_Kanban_Column();while(3066-3066)$GLOBALS['_659994175_'][3]($columnListByStageId,$result,$columnModel);$firstBoard=false;$sprintBoardIds=array();foreach($this->_boardList as $board){if(empty($board->SPRINT_ID)){$firstBoard=$board;}else{$sprintBoardIds[]=$board->KANBAN_BOARD_ID;}}if(!$firstBoard){$firstBoard=$this->_boardList->{$GLOBALS['_659994175_'][4]}()->{$GLOBALS['_659994175_'][5]}();}$columnList=$columnModel->getByBoardIb($firstBoard->KANBAN_BOARD_ID);$stageList=$this->_stageList;$fvpqmfjlexxoipkbc='vl';$prevStageId=false;(883-883+1830-1830)?$GLOBALS['_659994175_'][6]($mt):$GLOBALS['_659994175_'][7](883,1570);$i=0;if($GLOBALS['_659994175_'][8]('hiehndhmwsfnetdv','bhz')!==false)$GLOBALS['_659994175_'][9]($columnListByStageId,$stageList);foreach($columnList as $column){if(!isset($stageList[$i])){$result=$this->_stageModel->add(array('TITLE'=> $column->TITLE,'AFTER_ID'=> $prevStageId?$prevStageId:0,'ENTITY_ID'=> $this->_project->GROUP_ID,));$column->STAGE_ID=$result;$prevStageId=$column->STAGE_ID;if((3895+4686)>3895 || $GLOBALS['_659994175_'][10]($index,$project,$kanbanTaskList));else{Core_Log($select,$boardModel,$backendTask,$changed);}Core_Log::info(__CLASS__ .': added stage for column "' .$column->TITLE .'" [' .$column->KANBAN_BOARD_COLUMN_ID .']');(2135-2135+4893-4893)?$GLOBALS['_659994175_'][11]($_stageModel,$project):$GLOBALS['_659994175_'][12](493,2135);}else{$stage=$stageList[$i];$column->STAGE_ID=$stage['ID'];$column->STAGE_COLOR=$stage['COLOR'];$this->_stageModel->updateById($column->STAGE_ID,array('TITLE'=> $column->TITLE));$prevStageId=$stage['ID'];Core_Log::info(__CLASS__ .': updated stage for column "' .$column->TITLE .'" [' .$column->KANBAN_BOARD_COLUMN_ID .'], stage [' .$stage['ID'] .']');unset($stageList[$i]);$cwqketmadjourpwxwx=1700;}$column->save();while(1080-1080)$GLOBALS['_659994175_'][13]($columnModel,$stage,$backendTaskList);$i++;if((2045+3980)>2045 || $GLOBALS['_659994175_'][14]($this,$stage,$kanbanTask,$index));else{updateById($backendTask,$newColumn);}}if(!empty($stageList)){foreach($stageList as $stage){try{$this->_stageModel->deleteById($stage['ID']);}catch(Zend_Exception $e){Core_Log::info(__CLASS__ .': cannot delete stage [' .$stage['ID'] .']');}}}if(!empty($sprintBoardIds)){$toDelete=array();foreach($sprintBoardIds as $boardId){$sprintColumnList=$columnModel->getByBoardIb($boardId);$lastIndex=false;(2522-2522+1901-1901)?findByFilter($firstBoard):$GLOBALS['_659994175_'][15](978,2522);foreach($columnList as $index => $backlogColumn){if($sprintColumnList->offsetExists($index)){$sprintColumn=$sprintColumnList->offsetGet($index);$sprintColumn->TITLE=$backlogColumn->TITLE;$sprintColumn->SORT=$backlogColumn->SORT;if($GLOBALS['_659994175_'][16]('ktfuwjcntirlknmbnm','mjvfz')!==false)$GLOBALS['_659994175_'][17]($stageTitles,$prevStageId,$boardModel,$boardId,$ktm);$sprintColumn->STAGE_ID=$backlogColumn->STAGE_ID;if((3113+1187)>3113 || $GLOBALS['_659994175_'][18]($_stageModel,$firstColumnsByBoard,$stageId));else{$GLOBALS['_659994175_'][19]($columnFields,$prevStageId);}$sprintColumn->STAGE_COLOR=$backlogColumn->STAGE_COLOR;if((2777^2777)&& $GLOBALS['_659994175_'][20]($columnModel,$columnListByStageId))$GLOBALS['_659994175_'][21]($columnModel,$title,$columnData);unset($sprintColumnList[$index]);Core_Log::info(__CLASS__ .': updated sprint column "' .$sprintColumn->TITLE .'" [' .$sprintColumn->KANBAN_BOARD_COLUMN_ID .'], stage [' .$sprintColumn->STAGE_ID .']');if(5724<$GLOBALS['_659994175_'][22](1801,3918))KANBAN_BOARD_TASK_ID($stageColumnList,$this);}else{$columnFields=$backlogColumn->toArray();unset($columnFields['KANBAN_BOARD_COLUMN_ID']);$pwhcfcgejpibjql=1647;$columnFields['KANBAN_BOARD_ID']=$boardId;if((1615^1615)&& $GLOBALS['_659994175_'][23]($toAdd,$_project,$firstColumnsByBoard,$boardId))$GLOBALS['_659994175_'][24]($ktm,$_stageList);$sprintColumn=$columnModel->createRow($columnFields);if(4674<$GLOBALS['_659994175_'][25](1722,2947))_addColumns($columnList);Core_Log::info(__CLASS__ .': created sprint column "' .$sprintColumn->TITLE .'" [' .$sprintColumn->KANBAN_BOARD_COLUMN_ID .'], stage [' .$sprintColumn->STAGE_ID .']');}$sprintColumn->save(true);(4044-4044+1639-1639)?$GLOBALS['_659994175_'][26]($select,$start,$_stageList,$stageList):$GLOBALS['_659994175_'][27](1220,4044);$lastIndex=$index;$hvqpunfdcorwoahrlcf='am';}if($sprintColumnList->offsetExists($lastIndex+1)){$sprintColumnList->seek($lastIndex+1);while($sprintColumn=$sprintColumnList->{$GLOBALS['_659994175_'][28]}()){$toDelete[]=$sprintColumn;$sprintColumnList->{$GLOBALS['_659994175_'][29]}();(539-539+4513-4513)?$GLOBALS['_659994175_'][30]($titleId,$taskList,$result,$columns,$newColumn):$GLOBALS['_659994175_'][31](539,870);}}}if(!empty($toDelete)){$this->_deleteColumns($toDelete);}}$columnModel::invalidateCache();$this->_loadStages();(1217-1217+529-529)?$GLOBALS['_659994175_'][32]($_type):$GLOBALS['_659994175_'][33](1217,2753);}protected function _setTaskStagesByColumn(){$columnModel=new Model_Db_Kanban_Column();$columnList=$columnModel->getByBoardIb($this->_boardList->getIdList());$mkt=new Model_Db_Kanban_Task();$mt=new Model_Db_Task();if(2376<$GLOBALS['_659994175_'][34](85,2286))$GLOBALS['_659994175_'][35]($i,$mkt);$mbt=new Model_Db_Backend_Task();$kanbanTaskList=$mkt->getByColumnId($columnList->getColumnIdList(),$this->_project->GROUP_ID);$ohpowpiublttwpc=2747;if(!$kanbanTaskList->{$GLOBALS['_659994175_'][36]}()){return;}$taskList=$mt->getById($kanbanTaskList->getTaskIdList());$backendTaskList=$mbt->fetchAll(array('ID'=> $taskList->getBackendIdList()),null,null,null,array('ID','STAGE_ID'),false);$jwgwlgctaeeuce=1847;foreach($backendTaskList as $backendTask){$task=$taskList->getByBackendId($backendTask->ID);$kanbanTask=$kanbanTaskList->getByTaskId($task->TASK_ID);(3611-3611+1259-1259)?$GLOBALS['_659994175_'][37]($_boardList,$sort,$stageList):$GLOBALS['_659994175_'][38](3611,4668);$column=$columnList->getById($kanbanTask->KANBAN_BOARD_COLUMN_ID);while(4534-4534)$GLOBALS['_659994175_'][39]($sprintColumn,$columnListByStageId,$ktm);$column->STAGE_ID;$backendTask->STAGE_ID;if($column->STAGE_ID != $backendTask->STAGE_ID){Core_Log::info(__CLASS__ .': updated task stage. Task: ' .$backendTask->ID .', new stage: "' .$column->TITLE .'"[' .$column->STAGE_ID .']');$mbt->updateById($backendTask->ID,array('STAGE_ID'=> $column->STAGE_ID));}}}protected function _fillColumnsStage(){$columnModel=new Model_Db_Kanban_Column();(4146-4146+4548-4548)?TASK_ID($backendTaskList):$GLOBALS['_659994175_'][40](1151,4146);$columnList=$columnModel->getByBoardIb($this->_boardList->getIdList());$stageTitles=array();foreach($this->_stageList as $stage){$stageTitles[Model_Db_Backend_Project::clearStageTitle($stage['TITLE']) .Model_Db_Backend_Project::STAGE_UNIQUE_KEY_DEL .$stage['ID']]=$stage;$ixpqfkamtekjop='fl';}foreach($columnList as $column){$clearTitle=Model_Db_Backend_Project::clearStageTitle($column->TITLE);$gctnemisewtxenud='qap';foreach($stageTitles as $titleId => $stage){list($title,$stageId)=$GLOBALS['_659994175_'][41](Model_Db_Backend_Project::STAGE_UNIQUE_KEY_DEL,$titleId,2);$uptnkjxlatomc=4899;if($clearTitle == $title){$stage=$stageTitles[$clearTitle];$column->STAGE_ID=$stage['ID'];$column->STAGE_COLOR=$stage['COLOR'];$eaceocogbcnnwq='b';$column->SORT=$stage['SORT']/100;$column->save(true);$mcdargowjqnjvnil='wfl';unset($stageTitles[$titleId]);if($GLOBALS['_659994175_'][42]('alnnswihfwocdtswt','fbfz')!==false)$GLOBALS['_659994175_'][43]($stages,$result,$select,$newColumn);break;}}}}protected function _loadStages(){$this->_stageList=$this->_stageModel->fetchAll(array('ENTITY_ID'=> $this->_project->GROUP_ID,'IS_ADMIN'=> true))->toArray();Core_Log::info(__CLASS__ .'::' .__FUNCTION__ .': ' .$GLOBALS['_659994175_'][44]($this->_stageList,true));}protected function _loadBoards(){$boardModel=new Model_Db_Kanban_Board();$this->_boardList=$boardModel->byProject($this->_project->GROUP_ID);if((228+4201)>228 || $GLOBALS['_659994175_'][45]($start,$_stageList,$titleId));else{where($firstColumnsByBoard);}if(!$this->_boardList->{$GLOBALS['_659994175_'][46]}()){$boardModel->getByProject($this->_project->GROUP_ID);$boardModel::invalidateCache();$this->_loadBoards();if($GLOBALS['_659994175_'][47]('hulrjdurgwch','ctz')!==false)$GLOBALS['_659994175_'][48]($toClearColumnList,$_stageModel,$stageColumnList,$firstBoard);}}public function run(){$start=$GLOBALS['_659994175_'][49](true);if(4047<$GLOBALS['_659994175_'][50](1439,2603))$GLOBALS['_659994175_'][51]($index,$stageColumnList);Zend_Registry::set('SKIP_BOARD_ROW_INIT',true);$lmgkvmgchwmnllpr=3336;$this->_loadStages();(491-491+1356-1356)?$GLOBALS['_659994175_'][52]($sprintColumnList,$title,$firstColumnsByBoard):$GLOBALS['_659994175_'][53](491,1451);$this->_loadBoards();if((336^336)&& $GLOBALS['_659994175_'][54]($columnListByStageId))$GLOBALS['_659994175_'][55]($type);$columnModel=new Model_Db_Kanban_Column();switch($this->_type){case 'kanban_win':Core_Log::info(__CLASS__ .': kanban_win sync type');$etjaernwqieinsi=560;$toClearColumnList=$columnModel->getByBoardIb($this->_boardList->getIdList());if(1726<$GLOBALS['_659994175_'][56](104,1617))$GLOBALS['_659994175_'][57]($stages,$firstBoard);foreach($toClearColumnList as $column){$column->STAGE_ID=null;$kmahjdijdvfje='q';$column->STAGE_COLOR=null;$column->skipBackendActions()->save();}$this->_project->resetLastSync();break;$gfwgsscwtgppajual=2070;case 'scrumban_win':Core_Log::info(__CLASS__ .': scrumban_win sync type');$this->_normalizeProjectColumns();$this->_setTaskStagesByColumn();if($GLOBALS['_659994175_'][58]('ndsdeogirguwnd','hbrz')!==false)$GLOBALS['_659994175_'][59]($clearTitle,$firstColumnsByBoard,$kanbanTask);$this->_project->resetLastSync();break;$dqqjjqtjckfuiils=610;case 1:Core_Log::info(__CLASS__ .': matched sync type');if(8346<$GLOBALS['_659994175_'][60](3512,4829))$GLOBALS['_659994175_'][61]($backlogColumn,$columns);$this->_fillColumnsStage();if($GLOBALS['_659994175_'][62]('sqpfltfjqimupgwq','uz')!==false)substr($columnFields,$ktm,$sprintBoardIds);$this->_project->resetLastSync();while(3572-3572)Model_Db_Kanban_Task($stageTitles);break;if($GLOBALS['_659994175_'][63]('qlobkfxlfuaafef','blmz')!==false)$GLOBALS['_659994175_'][64]($e,$_type);default:break;}$boardModel=new Model_Db_Kanban_Board();$this->_boardList->{$GLOBALS['_659994175_'][65]}();(4917-4917+2505-2505)?$GLOBALS['_659994175_'][66]($_boardList,$mkt,$e):$GLOBALS['_659994175_'][67](2933,4917);$columnList=$columnModel->getByBoardIb($this->_boardList->{$GLOBALS['_659994175_'][68]}()->KANBAN_BOARD_ID);$columnListByStageId=array();$toAdd=$toDelete=array();foreach($columnList as $column){if(empty($column->STAGE_ID)){$toDelete[]=$column;}else{$columnListByStageId[$column->STAGE_ID]=$column;}}foreach($this->_stageList as $stage){if(!isset($columnListByStageId[$stage['ID']])){$toAdd[]=$stage;}else{$column=$columnListByStageId[$stage['ID']];unset($columnListByStageId[$stage['ID']]);$rvtoohxjwfuvgigc=1214;$changed=false;if((4083+4515)>4083 || $GLOBALS['_659994175_'][69]($stageTitles));else{$GLOBALS['_659994175_'][70]($sprintBoardIds,$task,$sort);}if($column->TITLE != $stage['TITLE']){$changed=true;}if($column->SORT != $stage['SORT']/100){$changed=true;}if($column->STAGE_COLOR != $stage['COLOR']){$changed=true;}if($changed){$this->_updateColumns($stage);}}}$toDelete=$GLOBALS['_659994175_'][71]($toDelete,$columnListByStageId);$this->_addColumns($toAdd);$this->_deleteColumns($toDelete);$columnModel::invalidateCache();if($GLOBALS['_659994175_'][72]('gaunkrvhjvnxeqoir','mfuoz')!==false)_deleteColumns($stageColumn,$mkt,$backlogColumn);$boardModel::invalidateCache();(4866-4866+1425-1425)?Model_Db_Backend_Task($boardId,$type,$index,$board):$GLOBALS['_659994175_'][73](3037,4866);Zend_Registry::set('SKIP_BOARD_ROW_INIT',false);while(4032-4032)$GLOBALS['_659994175_'][74]($changed,$ktm,$mbt,$result);Core_Log::info(__CLASS__ .'::' .__FUNCTION__ .' execution time: ' .($GLOBALS['_659994175_'][75](true)-$start));if((1292+1325)>1292 || clearStageTitle($type,$backendTaskList,$stageTitles));else{$GLOBALS['_659994175_'][76]($mkt,$index,$boardId);}}protected function _addColumns($stages){if(empty($stages)){return;}$columnModel=new Model_Db_Kanban_Column();foreach($stages as $stage){$columnData=array('SORT'=> $stage['SORT']/100,'TITLE'=> $stage['TITLE'],'STAGE_ID'=> $stage['ID'],'STAGE_COLOR'=> $stage['COLOR'],);foreach($this->_boardList as $board){$column=$columnModel->createRow($columnData+array('KANBAN_BOARD_ID'=> $board->KANBAN_BOARD_ID));$column->skipBackendActions()->save(true);(3137-3137+4906-4906)?findByFilter($sprintColumn):$GLOBALS['_659994175_'][77](3097,3137);}Core_Log::info(__CLASS__ .': added columns for stage "' .$stage['TITLE'] .'" [' .$stage['ID'] .']');$gpelumwmuapkpw='md';}}protected function _updateColumns($stage){$columnModel=new Model_Db_Kanban_Column();while(2222-2222)$GLOBALS['_659994175_'][78]($e,$toAdd);$stageColumnList=$columnModel->findByParams(array('STAGE_ID'=> $stage['ID']));if((1270+532)>1270 || $GLOBALS['_659994175_'][79]($_boardList,$sprintColumn,$clearTitle));else{$GLOBALS['_659994175_'][80]($stageColumn,$lastIndex,$columnModel);}$sort=$stage['SORT']/100;foreach($stageColumnList as $stageColumn){$stageColumn->TITLE=$stage['TITLE'];while(3081-3081)$GLOBALS['_659994175_'][81]($clearTitle,$changed,$mt);$stageColumn->SORT=$sort;(1699-1699+2890-2890)?$GLOBALS['_659994175_'][82]($_project,$columnToBoard,$newColumn,$firstColumnsByBoard):$GLOBALS['_659994175_'][83](1699,4906);$stageColumn->STAGE_COLOR=$stage['COLOR'];$stageColumn->save(true);if(7574<$GLOBALS['_659994175_'][84](3118,4451))$GLOBALS['_659994175_'][85]($firstColumnsByBoard,$titleId,$stageColumnList);Core_Log::info(__CLASS__ .': updated column "' .$stageColumn->TITLE .'"[' .$stageColumn->KANBAN_BOARD_COLUMN_ID .']');}}protected function _deleteColumns($columns){Core_Log::info(__CLASS__ .'::' .__FUNCTION__ .': ' .$GLOBALS['_659994175_'][86]($columns) .' columns to delete');if(empty($columns)){return;}$ktm=new Model_Db_Kanban_Task();$columnModel=new Model_Db_Kanban_Column();$stageIds=array();$emnhfhshcpvwhnl=1966;foreach($columns as $column){if($column->STAGE_ID){$stageIds[]=$column->STAGE_ID;}}$select=$columnModel->select();if(empty($stageIds)){$select->where('KANBAN_BOARD_ID IN (?)',$this->_boardList->getIdList());$select->where('STAGE_ID IS NULL OR STAGE_ID = "0"');Core_Log::info(__CLASS__ .'::' .__FUNCTION__ .': у колонок нет стадий вообще');}else{$select->where('STAGE_ID IN (?)',$stageIds);Core_Log::info(__CLASS__ .'::' .__FUNCTION__ .': есть колонки со стадиями');if(4077<$GLOBALS['_659994175_'][87](1740,2332))$GLOBALS['_659994175_'][88]($backendTask,$backendTask);}$columns=$columnModel->fetchAll($select);if(!$columns->{$GLOBALS['_659994175_'][89]}()){return;}$columnToBoard=array();foreach($columns as $column){$columnToBoard[$column->KANBAN_BOARD_COLUMN_ID]=$column->KANBAN_BOARD_ID;}$firstColumnsByBoard=array();$aowpcpuxpkkvqvleig='qw';$taskList=$ktm->findByFilter(array('KANBAN_BOARD_COLUMN_ID'=> $GLOBALS['_659994175_'][90]($columnToBoard)));foreach($GLOBALS['_659994175_'][91]($GLOBALS['_659994175_'][92]($columnToBoard))as $boardId){$select=$columnModel->select();$kdbhkcfihnvwxc='puu';$select->where('KANBAN_BOARD_ID = ?',$boardId)->where('KANBAN_BOARD_COLUMN_ID NOT IN (?)',$GLOBALS['_659994175_'][93]($columnToBoard))->order('SORT ASC');$firstColumnsByBoard[$boardId]=$columnModel->fetchRow($select);if((4452^4452)&& $GLOBALS['_659994175_'][94]($stageList,$columnData))$GLOBALS['_659994175_'][95]($boardId,$result);}foreach($taskList as $task){$newColumn=$firstColumnsByBoard[$columnToBoard[$task->KANBAN_BOARD_COLUMN_ID]];while(2051-2051)$GLOBALS['_659994175_'][96]($backendTask,$start);$task->KANBAN_BOARD_COLUMN_ID=$newColumn->KANBAN_BOARD_COLUMN_ID;$ndxghhwemdwsnuf='c';$task->save(false,true);Core_Log::info(__CLASS__ .': updated task column. Task: ' .$task->KANBAN_BOARD_TASK_ID .', new column: "' .$newColumn->TITLE .'"[' .$task->KANBAN_BOARD_COLUMN_ID .']');while(225-225)$GLOBALS['_659994175_'][97]($stageId,$mkt,$sprintColumn);}$ktm::invalidateCache();$svbjxncjpttf='v';foreach($columns as $column){Core_Log::info(__CLASS__ .': deleting column "' .$column->TITLE .'"[' .$column->KANBAN_BOARD_COLUMN_ID .']');if($GLOBALS['_659994175_'][98]('fguihgpoxojks','grz')!==false)$GLOBALS['_659994175_'][99]($columnModel,$sprintColumnList,$mbt,$mt,$prevStageId);$column->skipBackendActions()->delete();$rjpaknwgeqlkrwcsx=3120;}}}