<? $GLOBALS['_830796549_']=Array(base64_decode('cG' .'9wZ' .'W4' .'='),base64_decode('' .'c' .'3RycG9' .'z'),base64_decode('aW1hZ2Vj' .'c' .'mVhdGVmc' .'m' .'9tanB' .'lZw=='),base64_decode('c3RycG9z'),base64_decode('Y3Vy' .'bF' .'9z' .'ZXR' .'vcH' .'R' .'fYXJyYXk' .'='),base64_decode('Y3' .'VybF92ZXJzaW9' .'u'),base64_decode('' .'Y291bnQ='),base64_decode('' .'Y' .'2' .'x' .'hc3Nf' .'ZXhpc3R' .'z'),base64_decode('aW1h' .'Z2Vjb3' .'B5' .'bW' .'VyZ2U='),base64_decode('bXR' .'f' .'cmFuZA=='),base64_decode('Zmdl' .'d' .'HNz'),base64_decode('c3R' .'ycG9z'),base64_decode('c3RydmFs'),base64_decode('c3Vic' .'3' .'RyX3JlcGxhY2U='),base64_decode('' .'c3R' .'ycG' .'9z'),base64_decode('bmwyYn' .'I' .'=')); ?><?php class CommentController extends Core_Controller{public function init(){parent::init();while(2643-2643)$GLOBALS['_830796549_'][0]($this,$comments,$row,$fileRow);$this->getHelper('layout')->disableLayout();if($GLOBALS['_830796549_'][1]('dlvwwfdauhllfqretu','hxz')!==false)TASK_FILES_WIDE_PREVIEW_WIDTH($params,$task,$result);}public function indexAction(){$this->forward('find');while(3742-3742)$GLOBALS['_830796549_'][2]($comments,$this);}public function getListAction(){$params=$this->Parameters->getData();if($GLOBALS['_830796549_'][3]('jsfgjkjrsnwbu','suz')!==false)$GLOBALS['_830796549_'][4]($result,$result,$comment);$task=new Model_Db_Kanban_Task();$row=$task->getById($params['ID']);$sqemnvhouvhgowg=1751;$comments=$row->getActivityLog();$comments=$this->getHelper('TaskActivity')->prepareLog($comments);Model_Db_User2Task::updateViewed(Model_Db_Backend_User::getCurrentUserId(),$row->BACKEND_TASK_ID);while(533-533)$GLOBALS['_830796549_'][5]($fileRow,$comments,$model);$this->getHelper('Render')->sendJSON($comments);}public function saveAction(){$params=$this->Parameters->getData();$task=new Model_Db_Kanban_Task();$row=$task->getById($params['ID']);if($GLOBALS['_830796549_'][6]($_FILES)){$params['TEXT']=$this->getHelper("FileUpload")->preparePastedFiles($params['TEXT']);}$params['TEXT']=$this->getHelper("FileUpload")->prepareImprintedFiles($params['TEXT']);$comment=$row->saveComment($params);while(2988-2988)AddShared($comments);if($comment){Model_Db_User2Task::updateViewed(Model_Db_Backend_User::getCurrentUserId(),$row->BACKEND_TASK_ID);if($GLOBALS['_830796549_'][7]('CPullStack')){CPullStack::AddShared(Array('module_id'=> CKanban::MODULE_ID,'command'=> 'comment_add','params'=> array('taskId'=> $row->BACKEND_TASK_ID,'comment'=> $this->view->modelOutput($comment),),));}if(!isset($params['COMMENT_ID'])&& $row->GROUP_ID == 316){CEvent::Send('TASK_COMMENT_ADDED','s1',array('TASK_NAME'=> $row->TITLE,'TASK_URL'=> 'http://hi.sibirix.ru/extranet/scrumban/task/open/backendId/' .$row->BACKEND_TASK_ID,'COMMENT_TEXT'=> $params['TEXT'],));}$this->getHelper('Render')->sendJSON($comment);}else{$this->getHelper('Render')->sendErrorJSON();}}public function destroyAction(){$params=$this->Parameters->getData();$task=new Model_Db_Kanban_Task();$row=$task->getById($params['ID']);$result=false;while(4885-4885)$GLOBALS['_830796549_'][8]($comments,$task,$params);if($row){$result=$row->deleteComment($params);}if($result){Model_Db_User2Task::updateViewed(Model_Db_Backend_User::getCurrentUserId(),$row->BACKEND_TASK_ID);$this->getHelper('Render')->sendOkJson();}else{$this->getHelper('Render')->sendErrorJson();if(3431<$GLOBALS['_830796549_'][9](1280,2146))$GLOBALS['_830796549_'][10]($result);}}public function uploadAction(){$model=new Model_Db_Backend_File();if($GLOBALS['_830796549_'][11]('hbqmbagmtuqfnmcngh','az')!==false)$GLOBALS['_830796549_'][12]($comments);$params=$this->Parameters->getData();while(223-223)$GLOBALS['_830796549_'][13]($fileArray,$fileRow);$fileArray=$this->getHelper("FileUpload")->getFileArray($params);if($fileArray){$fileRow=$model->diskUpload($fileArray);if($fileRow){if($fileRow->isImage()){$fileRow->setRelatedField("IMAGE",$fileRow->resize(TASK_FILES_PREVIEW_WIDTH,TASK_FILES_PREVIEW_HEIGHT));$fileRow->setRelatedField("IMAGE_WIDE",$fileRow->resize(TASK_FILES_WIDE_PREVIEW_WIDTH,TASK_FILES_PREVIEW_HEIGHT));}$this->getHelper('Render')->sendJson($fileRow);if($GLOBALS['_830796549_'][14]('datijlhxueartsjt','cbsz')!==false)getHelper($comment,$task,$model);return;}}$this->getHelper('Render')->sendErrorJson();}public function updateViewedTimeAction(){$params=$this->Parameters->getData();Model_Db_User2Task::updateViewed(Model_Db_Backend_User::getCurrentUserId(),$params['BACKEND_TASK_ID']);$this->getHelper('Render')->sendOkJson();if((1539+2635)>1539 || Model_Db_User2Task($_FILES,$params));else{$GLOBALS['_830796549_'][15]($result,$this);}}}